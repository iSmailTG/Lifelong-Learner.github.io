<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Ismail TG">
<meta name="dcterms.date" content="2022-10-26">

<title>Chapter 4: Deep learning for coders with fastai and pytorch – Ismail's Personal Blog</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" integrity="sha384-ZvpUoO/+PpLXR1lu4jmpXWu80pZlYUAfxl5NsBMWOEPSjUn/6Z/hRTt8+pR6L4N2" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-3a12b51ff0d0fb9893750dacdd7c721b.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdn.jsdelivr.net/npm/requirejs@2.3.6/require.min.js" integrity="sha384-c9c+LnTbwQ3aujuU7ULEPVvgLs+Fn6fJUvIGTsuu1ZcCf11fiEubah0ttpca4ntM sha384-6V1/AdqZRWk1KAlWbKBlGhN7VG4iE/yAZcO6NZPMF8od0vukrvr0tg4qY6NSrItx" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed fullcontent quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Ismail’s Personal Blog</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../blog.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/ismaai008l"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/ismailTG3"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Chapter 4: Deep learning for coders with fastai and pytorch</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">Fastai</div>
                <div class="quarto-category">Pytorch</div>
                <div class="quarto-category">Numpy</div>
                <div class="quarto-category">Pandas</div>
                <div class="quarto-category">Deep Learning</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Ismail TG </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">October 26, 2022</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<div id="cell-1" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}}" data-outputid="61c7053b-5d26-40d8-9071-4c8426ad3e25" data-execution_count="1">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a> <span class="op">!</span> [ <span class="op">-</span>e <span class="op">/</span>content ] <span class="op">&amp;&amp;</span> pip install <span class="op">-</span>Uqq fastbook</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> fastbook</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>fastbook.setup_book()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>     |████████████████████████████████| 719 kB 27.5 MB/s 
     |████████████████████████████████| 5.3 MB 55.1 MB/s 
     |████████████████████████████████| 441 kB 70.9 MB/s 
     |████████████████████████████████| 1.3 MB 56.3 MB/s 
     |████████████████████████████████| 1.6 MB 57.3 MB/s 
     |████████████████████████████████| 115 kB 72.1 MB/s 
     |████████████████████████████████| 163 kB 71.5 MB/s 
     |████████████████████████████████| 212 kB 55.8 MB/s 
     |████████████████████████████████| 127 kB 75.4 MB/s 
     |████████████████████████████████| 115 kB 75.4 MB/s 
     |████████████████████████████████| 7.6 MB 56.7 MB/s 
Mounted at /content/gdrive</code></pre>
</div>
</div>
<div id="cell-2" class="cell" data-execution_count="2">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastbook <span class="im">import</span> <span class="op">*</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastai.vision.widgets <span class="im">import</span> <span class="op">*</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>matplotlib.rc(<span class="st">'image'</span>, cmap<span class="op">=</span><span class="st">'Greys'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<section id="under-the-hood-training-a-digit-classifier" class="level1">
<h1>Under the Hood: Training a Digit Classifier</h1>
<ul>
<li>In this chapter we will try to understand the mechanisms of deep learning by solving a <strong>Computer Vision</strong> problem
<ul>
<li>we will try to build a model from scartch that can classify hand written digits ( 7’s and 3’s)</li>
</ul></li>
<li>In this chapter we will investigate how the model learn, and what’s are the key concepts of deep learning process</li>
</ul>
<section id="pixels-the-foundations-of-computer-vision" class="level2">
<h2 class="anchored" data-anchor-id="pixels-the-foundations-of-computer-vision">Pixels: The Foundations of Computer Vision</h2>
<ul>
<li>Computer are good with numbers, thats why in order to make them do computer vision tasks we need to turn images to series of numbers</li>
<li>We will use a small version of the famous dataset <strong>MNIST</strong> which contains only 2 digits <code>3</code> and <code>7</code>.</li>
<li>Our task here is create a Neural Network from scratch that can calssify <code>3</code> from <code>7</code>.</li>
</ul>
<div id="cell-7" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:37}}" data-outputid="0db219ce-d6f0-48a1-9d1f-200eed567e9c" data-execution_count="3">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">#download the dataset;</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co">#MNIST_simple is a small mnist that contains only 7s and 3s</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>path <span class="op">=</span> untar_data(URLs.MNIST_SAMPLE)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

    <div>
      <progress value="3219456" class="" max="3214948" style="width:300px; height:20px; vertical-align: middle;"></progress>
      100.14% [3219456/3214948 00:01&lt;00:00]
    </div>
    
</div>
</div>
<div id="cell-8" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}}" data-outputid="3438fba3-8162-4418-c1a1-f1f85f586ff8" data-execution_count="4">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">#here is where the dataset is stored</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>path</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<pre><code>Path('/root/.fastai/data/mnist_sample')</code></pre>
</div>
</div>
<div id="cell-9" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}}" data-outputid="28175f9d-f988-46b7-f058-76358f0129bc" data-execution_count="5">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># we can use ls() to investigate the dataset</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co"># we have 3 directories: train, valid, labels.csv</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>path.ls()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<pre><code>(#3) [Path('/root/.fastai/data/mnist_sample/labels.csv'),Path('/root/.fastai/data/mnist_sample/train'),Path('/root/.fastai/data/mnist_sample/valid')]</code></pre>
</div>
</div>
<div id="cell-10" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}}" data-outputid="f08ddc0e-bbaf-47b3-a773-92cf8d767108" data-execution_count="6">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">#inside of train/valid folders, there's is 2 folders: 7, 3</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>(path<span class="op">/</span><span class="st">'train'</span>).ls()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<pre><code>(#2) [Path('/root/.fastai/data/mnist_sample/train/3'),Path('/root/.fastai/data/mnist_sample/train/7')]</code></pre>
</div>
</div>
<div id="cell-11" class="cell" data-execution_count="7">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co">#let's have a look at what in those folders while we sorted them an put them into variables ('threes and sevens')</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>threes <span class="op">=</span> (path<span class="op">/</span><span class="st">'train'</span><span class="op">/</span><span class="st">'3'</span>).ls().<span class="bu">sorted</span>()</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>sevens <span class="op">=</span> (path<span class="op">/</span><span class="st">'train'</span><span class="op">/</span><span class="st">'7'</span>).ls().<span class="bu">sorted</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-12" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}}" data-outputid="8c132bae-c052-4177-b881-80cbdcd94365" data-execution_count="8">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>threes[<span class="op">-</span><span class="dv">1</span>], threes[<span class="dv">22</span>]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<pre><code>(Path('/root/.fastai/data/mnist_sample/train/3/9991.png'),
 Path('/root/.fastai/data/mnist_sample/train/3/10210.png'))</code></pre>
</div>
</div>
<div id="cell-13" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:45}}" data-outputid="20743a90-b482-4662-93b4-543041122024" data-execution_count="9">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">#let's open it </span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>img_path <span class="op">=</span> threes[<span class="dv">1</span>]</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>img <span class="op">=</span> Image.<span class="bu">open</span>(img_path)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>img</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<div>
<figure class="figure">
<p><img src="Ch4_files/figure-html/cell-10-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>In a computer, everything is represented as a numbers.</li>
<li>To view the numbers that make up this image, we have to convert it to a <em>NumPy array</em> or a <em>PyTorch tensor</em>.</li>
</ul>
<div id="cell-15" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}}" data-outputid="1335cf27-6665-448f-caec-2bfa88c57c80" data-execution_count="10">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># here we use numpy array to represent that image "img" as array (matrix) </span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="co"># the img here is represented as pixels</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="co"># the darker pixel are 0 or have values colser to 0, and the lighter pixels have higher values</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>array(img)[<span class="dv">4</span>:<span class="dv">10</span>, <span class="dv">4</span>:<span class="dv">10</span>]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<pre><code>array([[  0,   0,   0,   0,   0,   0],
       [  0,   0,   0,   0,   0,  29],
       [  0,   0,   0,  48, 166, 224],
       [  0,  93, 244, 249, 253, 187],
       [  0, 107, 253, 253, 230,  48],
       [  0,   3,  20,  20,  15,   0]], dtype=uint8)</code></pre>
</div>
</div>
<div id="cell-16" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}}" data-outputid="7e181ec2-65bd-434b-a3d0-754cd4028c47" data-execution_count="11">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co">#here we use Pytorch tensor which is the numpy array function of pytorch</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="co">#they have the same code, and the behave basically the same (in most cases), </span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co">#the main difference is tensors can be computed on GPu</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span>tensor(img)[<span class="dv">4</span>:<span class="dv">10</span>, <span class="dv">4</span>:<span class="dv">10</span>]</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>a</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<pre><code>tensor([[  0,   0,   0,   0,   0,   0],
        [  0,   0,   0,   0,   0,  29],
        [  0,   0,   0,  48, 166, 224],
        [  0,  93, 244, 249, 253, 187],
        [  0, 107, 253, 253, 230,  48],
        [  0,   3,  20,  20,  15,   0]], dtype=torch.uint8)</code></pre>
</div>
</div>
<ul>
<li>We ciuld convert a image into array/tensor, then represent it as pandas <code>DataFrame</code> by coloring each pixel using <code>background_gradient()</code>, the darker the pixel is the closer it is to the highest value <code>252</code>, this the image is the closer to <code>0</code>.</li>
</ul>
<div id="cell-18" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:928}}" data-outputid="a17261d5-6886-448c-b33e-e4468f7dc7d0" data-execution_count="12">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># here we demonstrate the image and pixels values</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="co"># values of each pixel varies between 0 and 255</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>img_t<span class="op">=</span> tensor(img)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame(img_t)</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>df.style.set_properties(<span class="op">**</span>{<span class="st">'font-size'</span>:<span class="st">'4pt'</span>}).background_gradient(<span class="st">'Greys'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="12">


<table id="T_3ce3e_" class="dataframe caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th class="blank level0" data-quarto-table-cell-role="th">&nbsp;</th>
<th class="col_heading level0 col0" data-quarto-table-cell-role="th">0</th>
<th class="col_heading level0 col1" data-quarto-table-cell-role="th">1</th>
<th class="col_heading level0 col2" data-quarto-table-cell-role="th">2</th>
<th class="col_heading level0 col3" data-quarto-table-cell-role="th">3</th>
<th class="col_heading level0 col4" data-quarto-table-cell-role="th">4</th>
<th class="col_heading level0 col5" data-quarto-table-cell-role="th">5</th>
<th class="col_heading level0 col6" data-quarto-table-cell-role="th">6</th>
<th class="col_heading level0 col7" data-quarto-table-cell-role="th">7</th>
<th class="col_heading level0 col8" data-quarto-table-cell-role="th">8</th>
<th class="col_heading level0 col9" data-quarto-table-cell-role="th">9</th>
<th class="col_heading level0 col10" data-quarto-table-cell-role="th">10</th>
<th class="col_heading level0 col11" data-quarto-table-cell-role="th">11</th>
<th class="col_heading level0 col12" data-quarto-table-cell-role="th">12</th>
<th class="col_heading level0 col13" data-quarto-table-cell-role="th">13</th>
<th class="col_heading level0 col14" data-quarto-table-cell-role="th">14</th>
<th class="col_heading level0 col15" data-quarto-table-cell-role="th">15</th>
<th class="col_heading level0 col16" data-quarto-table-cell-role="th">16</th>
<th class="col_heading level0 col17" data-quarto-table-cell-role="th">17</th>
<th class="col_heading level0 col18" data-quarto-table-cell-role="th">18</th>
<th class="col_heading level0 col19" data-quarto-table-cell-role="th">19</th>
<th class="col_heading level0 col20" data-quarto-table-cell-role="th">20</th>
<th class="col_heading level0 col21" data-quarto-table-cell-role="th">21</th>
<th class="col_heading level0 col22" data-quarto-table-cell-role="th">22</th>
<th class="col_heading level0 col23" data-quarto-table-cell-role="th">23</th>
<th class="col_heading level0 col24" data-quarto-table-cell-role="th">24</th>
<th class="col_heading level0 col25" data-quarto-table-cell-role="th">25</th>
<th class="col_heading level0 col26" data-quarto-table-cell-role="th">26</th>
<th class="col_heading level0 col27" data-quarto-table-cell-role="th">27</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th id="T_3ce3e_level0_row0" class="row_heading level0 row0" data-quarto-table-cell-role="th">0</th>
<td id="T_3ce3e_row0_col0" class="data row0 col0">0</td>
<td id="T_3ce3e_row0_col1" class="data row0 col1">0</td>
<td id="T_3ce3e_row0_col2" class="data row0 col2">0</td>
<td id="T_3ce3e_row0_col3" class="data row0 col3">0</td>
<td id="T_3ce3e_row0_col4" class="data row0 col4">0</td>
<td id="T_3ce3e_row0_col5" class="data row0 col5">0</td>
<td id="T_3ce3e_row0_col6" class="data row0 col6">0</td>
<td id="T_3ce3e_row0_col7" class="data row0 col7">0</td>
<td id="T_3ce3e_row0_col8" class="data row0 col8">0</td>
<td id="T_3ce3e_row0_col9" class="data row0 col9">0</td>
<td id="T_3ce3e_row0_col10" class="data row0 col10">0</td>
<td id="T_3ce3e_row0_col11" class="data row0 col11">0</td>
<td id="T_3ce3e_row0_col12" class="data row0 col12">0</td>
<td id="T_3ce3e_row0_col13" class="data row0 col13">0</td>
<td id="T_3ce3e_row0_col14" class="data row0 col14">0</td>
<td id="T_3ce3e_row0_col15" class="data row0 col15">0</td>
<td id="T_3ce3e_row0_col16" class="data row0 col16">0</td>
<td id="T_3ce3e_row0_col17" class="data row0 col17">0</td>
<td id="T_3ce3e_row0_col18" class="data row0 col18">0</td>
<td id="T_3ce3e_row0_col19" class="data row0 col19">0</td>
<td id="T_3ce3e_row0_col20" class="data row0 col20">0</td>
<td id="T_3ce3e_row0_col21" class="data row0 col21">0</td>
<td id="T_3ce3e_row0_col22" class="data row0 col22">0</td>
<td id="T_3ce3e_row0_col23" class="data row0 col23">0</td>
<td id="T_3ce3e_row0_col24" class="data row0 col24">0</td>
<td id="T_3ce3e_row0_col25" class="data row0 col25">0</td>
<td id="T_3ce3e_row0_col26" class="data row0 col26">0</td>
<td id="T_3ce3e_row0_col27" class="data row0 col27">0</td>
</tr>
<tr class="even">
<th id="T_3ce3e_level0_row1" class="row_heading level0 row1" data-quarto-table-cell-role="th">1</th>
<td id="T_3ce3e_row1_col0" class="data row1 col0">0</td>
<td id="T_3ce3e_row1_col1" class="data row1 col1">0</td>
<td id="T_3ce3e_row1_col2" class="data row1 col2">0</td>
<td id="T_3ce3e_row1_col3" class="data row1 col3">0</td>
<td id="T_3ce3e_row1_col4" class="data row1 col4">0</td>
<td id="T_3ce3e_row1_col5" class="data row1 col5">0</td>
<td id="T_3ce3e_row1_col6" class="data row1 col6">0</td>
<td id="T_3ce3e_row1_col7" class="data row1 col7">0</td>
<td id="T_3ce3e_row1_col8" class="data row1 col8">0</td>
<td id="T_3ce3e_row1_col9" class="data row1 col9">0</td>
<td id="T_3ce3e_row1_col10" class="data row1 col10">0</td>
<td id="T_3ce3e_row1_col11" class="data row1 col11">0</td>
<td id="T_3ce3e_row1_col12" class="data row1 col12">0</td>
<td id="T_3ce3e_row1_col13" class="data row1 col13">0</td>
<td id="T_3ce3e_row1_col14" class="data row1 col14">0</td>
<td id="T_3ce3e_row1_col15" class="data row1 col15">0</td>
<td id="T_3ce3e_row1_col16" class="data row1 col16">0</td>
<td id="T_3ce3e_row1_col17" class="data row1 col17">0</td>
<td id="T_3ce3e_row1_col18" class="data row1 col18">0</td>
<td id="T_3ce3e_row1_col19" class="data row1 col19">0</td>
<td id="T_3ce3e_row1_col20" class="data row1 col20">0</td>
<td id="T_3ce3e_row1_col21" class="data row1 col21">0</td>
<td id="T_3ce3e_row1_col22" class="data row1 col22">0</td>
<td id="T_3ce3e_row1_col23" class="data row1 col23">0</td>
<td id="T_3ce3e_row1_col24" class="data row1 col24">0</td>
<td id="T_3ce3e_row1_col25" class="data row1 col25">0</td>
<td id="T_3ce3e_row1_col26" class="data row1 col26">0</td>
<td id="T_3ce3e_row1_col27" class="data row1 col27">0</td>
</tr>
<tr class="odd">
<th id="T_3ce3e_level0_row2" class="row_heading level0 row2" data-quarto-table-cell-role="th">2</th>
<td id="T_3ce3e_row2_col0" class="data row2 col0">0</td>
<td id="T_3ce3e_row2_col1" class="data row2 col1">0</td>
<td id="T_3ce3e_row2_col2" class="data row2 col2">0</td>
<td id="T_3ce3e_row2_col3" class="data row2 col3">0</td>
<td id="T_3ce3e_row2_col4" class="data row2 col4">0</td>
<td id="T_3ce3e_row2_col5" class="data row2 col5">0</td>
<td id="T_3ce3e_row2_col6" class="data row2 col6">0</td>
<td id="T_3ce3e_row2_col7" class="data row2 col7">0</td>
<td id="T_3ce3e_row2_col8" class="data row2 col8">0</td>
<td id="T_3ce3e_row2_col9" class="data row2 col9">0</td>
<td id="T_3ce3e_row2_col10" class="data row2 col10">0</td>
<td id="T_3ce3e_row2_col11" class="data row2 col11">0</td>
<td id="T_3ce3e_row2_col12" class="data row2 col12">0</td>
<td id="T_3ce3e_row2_col13" class="data row2 col13">0</td>
<td id="T_3ce3e_row2_col14" class="data row2 col14">0</td>
<td id="T_3ce3e_row2_col15" class="data row2 col15">0</td>
<td id="T_3ce3e_row2_col16" class="data row2 col16">0</td>
<td id="T_3ce3e_row2_col17" class="data row2 col17">0</td>
<td id="T_3ce3e_row2_col18" class="data row2 col18">0</td>
<td id="T_3ce3e_row2_col19" class="data row2 col19">0</td>
<td id="T_3ce3e_row2_col20" class="data row2 col20">0</td>
<td id="T_3ce3e_row2_col21" class="data row2 col21">0</td>
<td id="T_3ce3e_row2_col22" class="data row2 col22">0</td>
<td id="T_3ce3e_row2_col23" class="data row2 col23">0</td>
<td id="T_3ce3e_row2_col24" class="data row2 col24">0</td>
<td id="T_3ce3e_row2_col25" class="data row2 col25">0</td>
<td id="T_3ce3e_row2_col26" class="data row2 col26">0</td>
<td id="T_3ce3e_row2_col27" class="data row2 col27">0</td>
</tr>
<tr class="even">
<th id="T_3ce3e_level0_row3" class="row_heading level0 row3" data-quarto-table-cell-role="th">3</th>
<td id="T_3ce3e_row3_col0" class="data row3 col0">0</td>
<td id="T_3ce3e_row3_col1" class="data row3 col1">0</td>
<td id="T_3ce3e_row3_col2" class="data row3 col2">0</td>
<td id="T_3ce3e_row3_col3" class="data row3 col3">0</td>
<td id="T_3ce3e_row3_col4" class="data row3 col4">0</td>
<td id="T_3ce3e_row3_col5" class="data row3 col5">0</td>
<td id="T_3ce3e_row3_col6" class="data row3 col6">0</td>
<td id="T_3ce3e_row3_col7" class="data row3 col7">0</td>
<td id="T_3ce3e_row3_col8" class="data row3 col8">0</td>
<td id="T_3ce3e_row3_col9" class="data row3 col9">0</td>
<td id="T_3ce3e_row3_col10" class="data row3 col10">0</td>
<td id="T_3ce3e_row3_col11" class="data row3 col11">0</td>
<td id="T_3ce3e_row3_col12" class="data row3 col12">0</td>
<td id="T_3ce3e_row3_col13" class="data row3 col13">0</td>
<td id="T_3ce3e_row3_col14" class="data row3 col14">0</td>
<td id="T_3ce3e_row3_col15" class="data row3 col15">0</td>
<td id="T_3ce3e_row3_col16" class="data row3 col16">0</td>
<td id="T_3ce3e_row3_col17" class="data row3 col17">0</td>
<td id="T_3ce3e_row3_col18" class="data row3 col18">0</td>
<td id="T_3ce3e_row3_col19" class="data row3 col19">0</td>
<td id="T_3ce3e_row3_col20" class="data row3 col20">0</td>
<td id="T_3ce3e_row3_col21" class="data row3 col21">0</td>
<td id="T_3ce3e_row3_col22" class="data row3 col22">0</td>
<td id="T_3ce3e_row3_col23" class="data row3 col23">0</td>
<td id="T_3ce3e_row3_col24" class="data row3 col24">0</td>
<td id="T_3ce3e_row3_col25" class="data row3 col25">0</td>
<td id="T_3ce3e_row3_col26" class="data row3 col26">0</td>
<td id="T_3ce3e_row3_col27" class="data row3 col27">0</td>
</tr>
<tr class="odd">
<th id="T_3ce3e_level0_row4" class="row_heading level0 row4" data-quarto-table-cell-role="th">4</th>
<td id="T_3ce3e_row4_col0" class="data row4 col0">0</td>
<td id="T_3ce3e_row4_col1" class="data row4 col1">0</td>
<td id="T_3ce3e_row4_col2" class="data row4 col2">0</td>
<td id="T_3ce3e_row4_col3" class="data row4 col3">0</td>
<td id="T_3ce3e_row4_col4" class="data row4 col4">0</td>
<td id="T_3ce3e_row4_col5" class="data row4 col5">0</td>
<td id="T_3ce3e_row4_col6" class="data row4 col6">0</td>
<td id="T_3ce3e_row4_col7" class="data row4 col7">0</td>
<td id="T_3ce3e_row4_col8" class="data row4 col8">0</td>
<td id="T_3ce3e_row4_col9" class="data row4 col9">0</td>
<td id="T_3ce3e_row4_col10" class="data row4 col10">0</td>
<td id="T_3ce3e_row4_col11" class="data row4 col11">0</td>
<td id="T_3ce3e_row4_col12" class="data row4 col12">0</td>
<td id="T_3ce3e_row4_col13" class="data row4 col13">0</td>
<td id="T_3ce3e_row4_col14" class="data row4 col14">0</td>
<td id="T_3ce3e_row4_col15" class="data row4 col15">0</td>
<td id="T_3ce3e_row4_col16" class="data row4 col16">0</td>
<td id="T_3ce3e_row4_col17" class="data row4 col17">0</td>
<td id="T_3ce3e_row4_col18" class="data row4 col18">0</td>
<td id="T_3ce3e_row4_col19" class="data row4 col19">0</td>
<td id="T_3ce3e_row4_col20" class="data row4 col20">0</td>
<td id="T_3ce3e_row4_col21" class="data row4 col21">0</td>
<td id="T_3ce3e_row4_col22" class="data row4 col22">0</td>
<td id="T_3ce3e_row4_col23" class="data row4 col23">0</td>
<td id="T_3ce3e_row4_col24" class="data row4 col24">0</td>
<td id="T_3ce3e_row4_col25" class="data row4 col25">0</td>
<td id="T_3ce3e_row4_col26" class="data row4 col26">0</td>
<td id="T_3ce3e_row4_col27" class="data row4 col27">0</td>
</tr>
<tr class="even">
<th id="T_3ce3e_level0_row5" class="row_heading level0 row5" data-quarto-table-cell-role="th">5</th>
<td id="T_3ce3e_row5_col0" class="data row5 col0">0</td>
<td id="T_3ce3e_row5_col1" class="data row5 col1">0</td>
<td id="T_3ce3e_row5_col2" class="data row5 col2">0</td>
<td id="T_3ce3e_row5_col3" class="data row5 col3">0</td>
<td id="T_3ce3e_row5_col4" class="data row5 col4">0</td>
<td id="T_3ce3e_row5_col5" class="data row5 col5">0</td>
<td id="T_3ce3e_row5_col6" class="data row5 col6">0</td>
<td id="T_3ce3e_row5_col7" class="data row5 col7">0</td>
<td id="T_3ce3e_row5_col8" class="data row5 col8">0</td>
<td id="T_3ce3e_row5_col9" class="data row5 col9">29</td>
<td id="T_3ce3e_row5_col10" class="data row5 col10">150</td>
<td id="T_3ce3e_row5_col11" class="data row5 col11">195</td>
<td id="T_3ce3e_row5_col12" class="data row5 col12">254</td>
<td id="T_3ce3e_row5_col13" class="data row5 col13">255</td>
<td id="T_3ce3e_row5_col14" class="data row5 col14">254</td>
<td id="T_3ce3e_row5_col15" class="data row5 col15">176</td>
<td id="T_3ce3e_row5_col16" class="data row5 col16">193</td>
<td id="T_3ce3e_row5_col17" class="data row5 col17">150</td>
<td id="T_3ce3e_row5_col18" class="data row5 col18">96</td>
<td id="T_3ce3e_row5_col19" class="data row5 col19">0</td>
<td id="T_3ce3e_row5_col20" class="data row5 col20">0</td>
<td id="T_3ce3e_row5_col21" class="data row5 col21">0</td>
<td id="T_3ce3e_row5_col22" class="data row5 col22">0</td>
<td id="T_3ce3e_row5_col23" class="data row5 col23">0</td>
<td id="T_3ce3e_row5_col24" class="data row5 col24">0</td>
<td id="T_3ce3e_row5_col25" class="data row5 col25">0</td>
<td id="T_3ce3e_row5_col26" class="data row5 col26">0</td>
<td id="T_3ce3e_row5_col27" class="data row5 col27">0</td>
</tr>
<tr class="odd">
<th id="T_3ce3e_level0_row6" class="row_heading level0 row6" data-quarto-table-cell-role="th">6</th>
<td id="T_3ce3e_row6_col0" class="data row6 col0">0</td>
<td id="T_3ce3e_row6_col1" class="data row6 col1">0</td>
<td id="T_3ce3e_row6_col2" class="data row6 col2">0</td>
<td id="T_3ce3e_row6_col3" class="data row6 col3">0</td>
<td id="T_3ce3e_row6_col4" class="data row6 col4">0</td>
<td id="T_3ce3e_row6_col5" class="data row6 col5">0</td>
<td id="T_3ce3e_row6_col6" class="data row6 col6">0</td>
<td id="T_3ce3e_row6_col7" class="data row6 col7">48</td>
<td id="T_3ce3e_row6_col8" class="data row6 col8">166</td>
<td id="T_3ce3e_row6_col9" class="data row6 col9">224</td>
<td id="T_3ce3e_row6_col10" class="data row6 col10">253</td>
<td id="T_3ce3e_row6_col11" class="data row6 col11">253</td>
<td id="T_3ce3e_row6_col12" class="data row6 col12">234</td>
<td id="T_3ce3e_row6_col13" class="data row6 col13">196</td>
<td id="T_3ce3e_row6_col14" class="data row6 col14">253</td>
<td id="T_3ce3e_row6_col15" class="data row6 col15">253</td>
<td id="T_3ce3e_row6_col16" class="data row6 col16">253</td>
<td id="T_3ce3e_row6_col17" class="data row6 col17">253</td>
<td id="T_3ce3e_row6_col18" class="data row6 col18">233</td>
<td id="T_3ce3e_row6_col19" class="data row6 col19">0</td>
<td id="T_3ce3e_row6_col20" class="data row6 col20">0</td>
<td id="T_3ce3e_row6_col21" class="data row6 col21">0</td>
<td id="T_3ce3e_row6_col22" class="data row6 col22">0</td>
<td id="T_3ce3e_row6_col23" class="data row6 col23">0</td>
<td id="T_3ce3e_row6_col24" class="data row6 col24">0</td>
<td id="T_3ce3e_row6_col25" class="data row6 col25">0</td>
<td id="T_3ce3e_row6_col26" class="data row6 col26">0</td>
<td id="T_3ce3e_row6_col27" class="data row6 col27">0</td>
</tr>
<tr class="even">
<th id="T_3ce3e_level0_row7" class="row_heading level0 row7" data-quarto-table-cell-role="th">7</th>
<td id="T_3ce3e_row7_col0" class="data row7 col0">0</td>
<td id="T_3ce3e_row7_col1" class="data row7 col1">0</td>
<td id="T_3ce3e_row7_col2" class="data row7 col2">0</td>
<td id="T_3ce3e_row7_col3" class="data row7 col3">0</td>
<td id="T_3ce3e_row7_col4" class="data row7 col4">0</td>
<td id="T_3ce3e_row7_col5" class="data row7 col5">93</td>
<td id="T_3ce3e_row7_col6" class="data row7 col6">244</td>
<td id="T_3ce3e_row7_col7" class="data row7 col7">249</td>
<td id="T_3ce3e_row7_col8" class="data row7 col8">253</td>
<td id="T_3ce3e_row7_col9" class="data row7 col9">187</td>
<td id="T_3ce3e_row7_col10" class="data row7 col10">46</td>
<td id="T_3ce3e_row7_col11" class="data row7 col11">10</td>
<td id="T_3ce3e_row7_col12" class="data row7 col12">8</td>
<td id="T_3ce3e_row7_col13" class="data row7 col13">4</td>
<td id="T_3ce3e_row7_col14" class="data row7 col14">10</td>
<td id="T_3ce3e_row7_col15" class="data row7 col15">194</td>
<td id="T_3ce3e_row7_col16" class="data row7 col16">253</td>
<td id="T_3ce3e_row7_col17" class="data row7 col17">253</td>
<td id="T_3ce3e_row7_col18" class="data row7 col18">233</td>
<td id="T_3ce3e_row7_col19" class="data row7 col19">0</td>
<td id="T_3ce3e_row7_col20" class="data row7 col20">0</td>
<td id="T_3ce3e_row7_col21" class="data row7 col21">0</td>
<td id="T_3ce3e_row7_col22" class="data row7 col22">0</td>
<td id="T_3ce3e_row7_col23" class="data row7 col23">0</td>
<td id="T_3ce3e_row7_col24" class="data row7 col24">0</td>
<td id="T_3ce3e_row7_col25" class="data row7 col25">0</td>
<td id="T_3ce3e_row7_col26" class="data row7 col26">0</td>
<td id="T_3ce3e_row7_col27" class="data row7 col27">0</td>
</tr>
<tr class="odd">
<th id="T_3ce3e_level0_row8" class="row_heading level0 row8" data-quarto-table-cell-role="th">8</th>
<td id="T_3ce3e_row8_col0" class="data row8 col0">0</td>
<td id="T_3ce3e_row8_col1" class="data row8 col1">0</td>
<td id="T_3ce3e_row8_col2" class="data row8 col2">0</td>
<td id="T_3ce3e_row8_col3" class="data row8 col3">0</td>
<td id="T_3ce3e_row8_col4" class="data row8 col4">0</td>
<td id="T_3ce3e_row8_col5" class="data row8 col5">107</td>
<td id="T_3ce3e_row8_col6" class="data row8 col6">253</td>
<td id="T_3ce3e_row8_col7" class="data row8 col7">253</td>
<td id="T_3ce3e_row8_col8" class="data row8 col8">230</td>
<td id="T_3ce3e_row8_col9" class="data row8 col9">48</td>
<td id="T_3ce3e_row8_col10" class="data row8 col10">0</td>
<td id="T_3ce3e_row8_col11" class="data row8 col11">0</td>
<td id="T_3ce3e_row8_col12" class="data row8 col12">0</td>
<td id="T_3ce3e_row8_col13" class="data row8 col13">0</td>
<td id="T_3ce3e_row8_col14" class="data row8 col14">0</td>
<td id="T_3ce3e_row8_col15" class="data row8 col15">192</td>
<td id="T_3ce3e_row8_col16" class="data row8 col16">253</td>
<td id="T_3ce3e_row8_col17" class="data row8 col17">253</td>
<td id="T_3ce3e_row8_col18" class="data row8 col18">156</td>
<td id="T_3ce3e_row8_col19" class="data row8 col19">0</td>
<td id="T_3ce3e_row8_col20" class="data row8 col20">0</td>
<td id="T_3ce3e_row8_col21" class="data row8 col21">0</td>
<td id="T_3ce3e_row8_col22" class="data row8 col22">0</td>
<td id="T_3ce3e_row8_col23" class="data row8 col23">0</td>
<td id="T_3ce3e_row8_col24" class="data row8 col24">0</td>
<td id="T_3ce3e_row8_col25" class="data row8 col25">0</td>
<td id="T_3ce3e_row8_col26" class="data row8 col26">0</td>
<td id="T_3ce3e_row8_col27" class="data row8 col27">0</td>
</tr>
<tr class="even">
<th id="T_3ce3e_level0_row9" class="row_heading level0 row9" data-quarto-table-cell-role="th">9</th>
<td id="T_3ce3e_row9_col0" class="data row9 col0">0</td>
<td id="T_3ce3e_row9_col1" class="data row9 col1">0</td>
<td id="T_3ce3e_row9_col2" class="data row9 col2">0</td>
<td id="T_3ce3e_row9_col3" class="data row9 col3">0</td>
<td id="T_3ce3e_row9_col4" class="data row9 col4">0</td>
<td id="T_3ce3e_row9_col5" class="data row9 col5">3</td>
<td id="T_3ce3e_row9_col6" class="data row9 col6">20</td>
<td id="T_3ce3e_row9_col7" class="data row9 col7">20</td>
<td id="T_3ce3e_row9_col8" class="data row9 col8">15</td>
<td id="T_3ce3e_row9_col9" class="data row9 col9">0</td>
<td id="T_3ce3e_row9_col10" class="data row9 col10">0</td>
<td id="T_3ce3e_row9_col11" class="data row9 col11">0</td>
<td id="T_3ce3e_row9_col12" class="data row9 col12">0</td>
<td id="T_3ce3e_row9_col13" class="data row9 col13">0</td>
<td id="T_3ce3e_row9_col14" class="data row9 col14">43</td>
<td id="T_3ce3e_row9_col15" class="data row9 col15">224</td>
<td id="T_3ce3e_row9_col16" class="data row9 col16">253</td>
<td id="T_3ce3e_row9_col17" class="data row9 col17">245</td>
<td id="T_3ce3e_row9_col18" class="data row9 col18">74</td>
<td id="T_3ce3e_row9_col19" class="data row9 col19">0</td>
<td id="T_3ce3e_row9_col20" class="data row9 col20">0</td>
<td id="T_3ce3e_row9_col21" class="data row9 col21">0</td>
<td id="T_3ce3e_row9_col22" class="data row9 col22">0</td>
<td id="T_3ce3e_row9_col23" class="data row9 col23">0</td>
<td id="T_3ce3e_row9_col24" class="data row9 col24">0</td>
<td id="T_3ce3e_row9_col25" class="data row9 col25">0</td>
<td id="T_3ce3e_row9_col26" class="data row9 col26">0</td>
<td id="T_3ce3e_row9_col27" class="data row9 col27">0</td>
</tr>
<tr class="odd">
<th id="T_3ce3e_level0_row10" class="row_heading level0 row10" data-quarto-table-cell-role="th">10</th>
<td id="T_3ce3e_row10_col0" class="data row10 col0">0</td>
<td id="T_3ce3e_row10_col1" class="data row10 col1">0</td>
<td id="T_3ce3e_row10_col2" class="data row10 col2">0</td>
<td id="T_3ce3e_row10_col3" class="data row10 col3">0</td>
<td id="T_3ce3e_row10_col4" class="data row10 col4">0</td>
<td id="T_3ce3e_row10_col5" class="data row10 col5">0</td>
<td id="T_3ce3e_row10_col6" class="data row10 col6">0</td>
<td id="T_3ce3e_row10_col7" class="data row10 col7">0</td>
<td id="T_3ce3e_row10_col8" class="data row10 col8">0</td>
<td id="T_3ce3e_row10_col9" class="data row10 col9">0</td>
<td id="T_3ce3e_row10_col10" class="data row10 col10">0</td>
<td id="T_3ce3e_row10_col11" class="data row10 col11">0</td>
<td id="T_3ce3e_row10_col12" class="data row10 col12">0</td>
<td id="T_3ce3e_row10_col13" class="data row10 col13">0</td>
<td id="T_3ce3e_row10_col14" class="data row10 col14">249</td>
<td id="T_3ce3e_row10_col15" class="data row10 col15">253</td>
<td id="T_3ce3e_row10_col16" class="data row10 col16">245</td>
<td id="T_3ce3e_row10_col17" class="data row10 col17">126</td>
<td id="T_3ce3e_row10_col18" class="data row10 col18">0</td>
<td id="T_3ce3e_row10_col19" class="data row10 col19">0</td>
<td id="T_3ce3e_row10_col20" class="data row10 col20">0</td>
<td id="T_3ce3e_row10_col21" class="data row10 col21">0</td>
<td id="T_3ce3e_row10_col22" class="data row10 col22">0</td>
<td id="T_3ce3e_row10_col23" class="data row10 col23">0</td>
<td id="T_3ce3e_row10_col24" class="data row10 col24">0</td>
<td id="T_3ce3e_row10_col25" class="data row10 col25">0</td>
<td id="T_3ce3e_row10_col26" class="data row10 col26">0</td>
<td id="T_3ce3e_row10_col27" class="data row10 col27">0</td>
</tr>
<tr class="even">
<th id="T_3ce3e_level0_row11" class="row_heading level0 row11" data-quarto-table-cell-role="th">11</th>
<td id="T_3ce3e_row11_col0" class="data row11 col0">0</td>
<td id="T_3ce3e_row11_col1" class="data row11 col1">0</td>
<td id="T_3ce3e_row11_col2" class="data row11 col2">0</td>
<td id="T_3ce3e_row11_col3" class="data row11 col3">0</td>
<td id="T_3ce3e_row11_col4" class="data row11 col4">0</td>
<td id="T_3ce3e_row11_col5" class="data row11 col5">0</td>
<td id="T_3ce3e_row11_col6" class="data row11 col6">0</td>
<td id="T_3ce3e_row11_col7" class="data row11 col7">0</td>
<td id="T_3ce3e_row11_col8" class="data row11 col8">0</td>
<td id="T_3ce3e_row11_col9" class="data row11 col9">0</td>
<td id="T_3ce3e_row11_col10" class="data row11 col10">0</td>
<td id="T_3ce3e_row11_col11" class="data row11 col11">14</td>
<td id="T_3ce3e_row11_col12" class="data row11 col12">101</td>
<td id="T_3ce3e_row11_col13" class="data row11 col13">223</td>
<td id="T_3ce3e_row11_col14" class="data row11 col14">253</td>
<td id="T_3ce3e_row11_col15" class="data row11 col15">248</td>
<td id="T_3ce3e_row11_col16" class="data row11 col16">124</td>
<td id="T_3ce3e_row11_col17" class="data row11 col17">0</td>
<td id="T_3ce3e_row11_col18" class="data row11 col18">0</td>
<td id="T_3ce3e_row11_col19" class="data row11 col19">0</td>
<td id="T_3ce3e_row11_col20" class="data row11 col20">0</td>
<td id="T_3ce3e_row11_col21" class="data row11 col21">0</td>
<td id="T_3ce3e_row11_col22" class="data row11 col22">0</td>
<td id="T_3ce3e_row11_col23" class="data row11 col23">0</td>
<td id="T_3ce3e_row11_col24" class="data row11 col24">0</td>
<td id="T_3ce3e_row11_col25" class="data row11 col25">0</td>
<td id="T_3ce3e_row11_col26" class="data row11 col26">0</td>
<td id="T_3ce3e_row11_col27" class="data row11 col27">0</td>
</tr>
<tr class="odd">
<th id="T_3ce3e_level0_row12" class="row_heading level0 row12" data-quarto-table-cell-role="th">12</th>
<td id="T_3ce3e_row12_col0" class="data row12 col0">0</td>
<td id="T_3ce3e_row12_col1" class="data row12 col1">0</td>
<td id="T_3ce3e_row12_col2" class="data row12 col2">0</td>
<td id="T_3ce3e_row12_col3" class="data row12 col3">0</td>
<td id="T_3ce3e_row12_col4" class="data row12 col4">0</td>
<td id="T_3ce3e_row12_col5" class="data row12 col5">0</td>
<td id="T_3ce3e_row12_col6" class="data row12 col6">0</td>
<td id="T_3ce3e_row12_col7" class="data row12 col7">0</td>
<td id="T_3ce3e_row12_col8" class="data row12 col8">0</td>
<td id="T_3ce3e_row12_col9" class="data row12 col9">11</td>
<td id="T_3ce3e_row12_col10" class="data row12 col10">166</td>
<td id="T_3ce3e_row12_col11" class="data row12 col11">239</td>
<td id="T_3ce3e_row12_col12" class="data row12 col12">253</td>
<td id="T_3ce3e_row12_col13" class="data row12 col13">253</td>
<td id="T_3ce3e_row12_col14" class="data row12 col14">253</td>
<td id="T_3ce3e_row12_col15" class="data row12 col15">187</td>
<td id="T_3ce3e_row12_col16" class="data row12 col16">30</td>
<td id="T_3ce3e_row12_col17" class="data row12 col17">0</td>
<td id="T_3ce3e_row12_col18" class="data row12 col18">0</td>
<td id="T_3ce3e_row12_col19" class="data row12 col19">0</td>
<td id="T_3ce3e_row12_col20" class="data row12 col20">0</td>
<td id="T_3ce3e_row12_col21" class="data row12 col21">0</td>
<td id="T_3ce3e_row12_col22" class="data row12 col22">0</td>
<td id="T_3ce3e_row12_col23" class="data row12 col23">0</td>
<td id="T_3ce3e_row12_col24" class="data row12 col24">0</td>
<td id="T_3ce3e_row12_col25" class="data row12 col25">0</td>
<td id="T_3ce3e_row12_col26" class="data row12 col26">0</td>
<td id="T_3ce3e_row12_col27" class="data row12 col27">0</td>
</tr>
<tr class="even">
<th id="T_3ce3e_level0_row13" class="row_heading level0 row13" data-quarto-table-cell-role="th">13</th>
<td id="T_3ce3e_row13_col0" class="data row13 col0">0</td>
<td id="T_3ce3e_row13_col1" class="data row13 col1">0</td>
<td id="T_3ce3e_row13_col2" class="data row13 col2">0</td>
<td id="T_3ce3e_row13_col3" class="data row13 col3">0</td>
<td id="T_3ce3e_row13_col4" class="data row13 col4">0</td>
<td id="T_3ce3e_row13_col5" class="data row13 col5">0</td>
<td id="T_3ce3e_row13_col6" class="data row13 col6">0</td>
<td id="T_3ce3e_row13_col7" class="data row13 col7">0</td>
<td id="T_3ce3e_row13_col8" class="data row13 col8">0</td>
<td id="T_3ce3e_row13_col9" class="data row13 col9">16</td>
<td id="T_3ce3e_row13_col10" class="data row13 col10">248</td>
<td id="T_3ce3e_row13_col11" class="data row13 col11">250</td>
<td id="T_3ce3e_row13_col12" class="data row13 col12">253</td>
<td id="T_3ce3e_row13_col13" class="data row13 col13">253</td>
<td id="T_3ce3e_row13_col14" class="data row13 col14">253</td>
<td id="T_3ce3e_row13_col15" class="data row13 col15">253</td>
<td id="T_3ce3e_row13_col16" class="data row13 col16">232</td>
<td id="T_3ce3e_row13_col17" class="data row13 col17">213</td>
<td id="T_3ce3e_row13_col18" class="data row13 col18">111</td>
<td id="T_3ce3e_row13_col19" class="data row13 col19">2</td>
<td id="T_3ce3e_row13_col20" class="data row13 col20">0</td>
<td id="T_3ce3e_row13_col21" class="data row13 col21">0</td>
<td id="T_3ce3e_row13_col22" class="data row13 col22">0</td>
<td id="T_3ce3e_row13_col23" class="data row13 col23">0</td>
<td id="T_3ce3e_row13_col24" class="data row13 col24">0</td>
<td id="T_3ce3e_row13_col25" class="data row13 col25">0</td>
<td id="T_3ce3e_row13_col26" class="data row13 col26">0</td>
<td id="T_3ce3e_row13_col27" class="data row13 col27">0</td>
</tr>
<tr class="odd">
<th id="T_3ce3e_level0_row14" class="row_heading level0 row14" data-quarto-table-cell-role="th">14</th>
<td id="T_3ce3e_row14_col0" class="data row14 col0">0</td>
<td id="T_3ce3e_row14_col1" class="data row14 col1">0</td>
<td id="T_3ce3e_row14_col2" class="data row14 col2">0</td>
<td id="T_3ce3e_row14_col3" class="data row14 col3">0</td>
<td id="T_3ce3e_row14_col4" class="data row14 col4">0</td>
<td id="T_3ce3e_row14_col5" class="data row14 col5">0</td>
<td id="T_3ce3e_row14_col6" class="data row14 col6">0</td>
<td id="T_3ce3e_row14_col7" class="data row14 col7">0</td>
<td id="T_3ce3e_row14_col8" class="data row14 col8">0</td>
<td id="T_3ce3e_row14_col9" class="data row14 col9">0</td>
<td id="T_3ce3e_row14_col10" class="data row14 col10">0</td>
<td id="T_3ce3e_row14_col11" class="data row14 col11">43</td>
<td id="T_3ce3e_row14_col12" class="data row14 col12">98</td>
<td id="T_3ce3e_row14_col13" class="data row14 col13">98</td>
<td id="T_3ce3e_row14_col14" class="data row14 col14">208</td>
<td id="T_3ce3e_row14_col15" class="data row14 col15">253</td>
<td id="T_3ce3e_row14_col16" class="data row14 col16">253</td>
<td id="T_3ce3e_row14_col17" class="data row14 col17">253</td>
<td id="T_3ce3e_row14_col18" class="data row14 col18">253</td>
<td id="T_3ce3e_row14_col19" class="data row14 col19">187</td>
<td id="T_3ce3e_row14_col20" class="data row14 col20">22</td>
<td id="T_3ce3e_row14_col21" class="data row14 col21">0</td>
<td id="T_3ce3e_row14_col22" class="data row14 col22">0</td>
<td id="T_3ce3e_row14_col23" class="data row14 col23">0</td>
<td id="T_3ce3e_row14_col24" class="data row14 col24">0</td>
<td id="T_3ce3e_row14_col25" class="data row14 col25">0</td>
<td id="T_3ce3e_row14_col26" class="data row14 col26">0</td>
<td id="T_3ce3e_row14_col27" class="data row14 col27">0</td>
</tr>
<tr class="even">
<th id="T_3ce3e_level0_row15" class="row_heading level0 row15" data-quarto-table-cell-role="th">15</th>
<td id="T_3ce3e_row15_col0" class="data row15 col0">0</td>
<td id="T_3ce3e_row15_col1" class="data row15 col1">0</td>
<td id="T_3ce3e_row15_col2" class="data row15 col2">0</td>
<td id="T_3ce3e_row15_col3" class="data row15 col3">0</td>
<td id="T_3ce3e_row15_col4" class="data row15 col4">0</td>
<td id="T_3ce3e_row15_col5" class="data row15 col5">0</td>
<td id="T_3ce3e_row15_col6" class="data row15 col6">0</td>
<td id="T_3ce3e_row15_col7" class="data row15 col7">0</td>
<td id="T_3ce3e_row15_col8" class="data row15 col8">0</td>
<td id="T_3ce3e_row15_col9" class="data row15 col9">0</td>
<td id="T_3ce3e_row15_col10" class="data row15 col10">0</td>
<td id="T_3ce3e_row15_col11" class="data row15 col11">0</td>
<td id="T_3ce3e_row15_col12" class="data row15 col12">0</td>
<td id="T_3ce3e_row15_col13" class="data row15 col13">0</td>
<td id="T_3ce3e_row15_col14" class="data row15 col14">9</td>
<td id="T_3ce3e_row15_col15" class="data row15 col15">51</td>
<td id="T_3ce3e_row15_col16" class="data row15 col16">119</td>
<td id="T_3ce3e_row15_col17" class="data row15 col17">253</td>
<td id="T_3ce3e_row15_col18" class="data row15 col18">253</td>
<td id="T_3ce3e_row15_col19" class="data row15 col19">253</td>
<td id="T_3ce3e_row15_col20" class="data row15 col20">76</td>
<td id="T_3ce3e_row15_col21" class="data row15 col21">0</td>
<td id="T_3ce3e_row15_col22" class="data row15 col22">0</td>
<td id="T_3ce3e_row15_col23" class="data row15 col23">0</td>
<td id="T_3ce3e_row15_col24" class="data row15 col24">0</td>
<td id="T_3ce3e_row15_col25" class="data row15 col25">0</td>
<td id="T_3ce3e_row15_col26" class="data row15 col26">0</td>
<td id="T_3ce3e_row15_col27" class="data row15 col27">0</td>
</tr>
<tr class="odd">
<th id="T_3ce3e_level0_row16" class="row_heading level0 row16" data-quarto-table-cell-role="th">16</th>
<td id="T_3ce3e_row16_col0" class="data row16 col0">0</td>
<td id="T_3ce3e_row16_col1" class="data row16 col1">0</td>
<td id="T_3ce3e_row16_col2" class="data row16 col2">0</td>
<td id="T_3ce3e_row16_col3" class="data row16 col3">0</td>
<td id="T_3ce3e_row16_col4" class="data row16 col4">0</td>
<td id="T_3ce3e_row16_col5" class="data row16 col5">0</td>
<td id="T_3ce3e_row16_col6" class="data row16 col6">0</td>
<td id="T_3ce3e_row16_col7" class="data row16 col7">0</td>
<td id="T_3ce3e_row16_col8" class="data row16 col8">0</td>
<td id="T_3ce3e_row16_col9" class="data row16 col9">0</td>
<td id="T_3ce3e_row16_col10" class="data row16 col10">0</td>
<td id="T_3ce3e_row16_col11" class="data row16 col11">0</td>
<td id="T_3ce3e_row16_col12" class="data row16 col12">0</td>
<td id="T_3ce3e_row16_col13" class="data row16 col13">0</td>
<td id="T_3ce3e_row16_col14" class="data row16 col14">0</td>
<td id="T_3ce3e_row16_col15" class="data row16 col15">0</td>
<td id="T_3ce3e_row16_col16" class="data row16 col16">1</td>
<td id="T_3ce3e_row16_col17" class="data row16 col17">183</td>
<td id="T_3ce3e_row16_col18" class="data row16 col18">253</td>
<td id="T_3ce3e_row16_col19" class="data row16 col19">253</td>
<td id="T_3ce3e_row16_col20" class="data row16 col20">139</td>
<td id="T_3ce3e_row16_col21" class="data row16 col21">0</td>
<td id="T_3ce3e_row16_col22" class="data row16 col22">0</td>
<td id="T_3ce3e_row16_col23" class="data row16 col23">0</td>
<td id="T_3ce3e_row16_col24" class="data row16 col24">0</td>
<td id="T_3ce3e_row16_col25" class="data row16 col25">0</td>
<td id="T_3ce3e_row16_col26" class="data row16 col26">0</td>
<td id="T_3ce3e_row16_col27" class="data row16 col27">0</td>
</tr>
<tr class="even">
<th id="T_3ce3e_level0_row17" class="row_heading level0 row17" data-quarto-table-cell-role="th">17</th>
<td id="T_3ce3e_row17_col0" class="data row17 col0">0</td>
<td id="T_3ce3e_row17_col1" class="data row17 col1">0</td>
<td id="T_3ce3e_row17_col2" class="data row17 col2">0</td>
<td id="T_3ce3e_row17_col3" class="data row17 col3">0</td>
<td id="T_3ce3e_row17_col4" class="data row17 col4">0</td>
<td id="T_3ce3e_row17_col5" class="data row17 col5">0</td>
<td id="T_3ce3e_row17_col6" class="data row17 col6">0</td>
<td id="T_3ce3e_row17_col7" class="data row17 col7">0</td>
<td id="T_3ce3e_row17_col8" class="data row17 col8">0</td>
<td id="T_3ce3e_row17_col9" class="data row17 col9">0</td>
<td id="T_3ce3e_row17_col10" class="data row17 col10">0</td>
<td id="T_3ce3e_row17_col11" class="data row17 col11">0</td>
<td id="T_3ce3e_row17_col12" class="data row17 col12">0</td>
<td id="T_3ce3e_row17_col13" class="data row17 col13">0</td>
<td id="T_3ce3e_row17_col14" class="data row17 col14">0</td>
<td id="T_3ce3e_row17_col15" class="data row17 col15">0</td>
<td id="T_3ce3e_row17_col16" class="data row17 col16">0</td>
<td id="T_3ce3e_row17_col17" class="data row17 col17">182</td>
<td id="T_3ce3e_row17_col18" class="data row17 col18">253</td>
<td id="T_3ce3e_row17_col19" class="data row17 col19">253</td>
<td id="T_3ce3e_row17_col20" class="data row17 col20">104</td>
<td id="T_3ce3e_row17_col21" class="data row17 col21">0</td>
<td id="T_3ce3e_row17_col22" class="data row17 col22">0</td>
<td id="T_3ce3e_row17_col23" class="data row17 col23">0</td>
<td id="T_3ce3e_row17_col24" class="data row17 col24">0</td>
<td id="T_3ce3e_row17_col25" class="data row17 col25">0</td>
<td id="T_3ce3e_row17_col26" class="data row17 col26">0</td>
<td id="T_3ce3e_row17_col27" class="data row17 col27">0</td>
</tr>
<tr class="odd">
<th id="T_3ce3e_level0_row18" class="row_heading level0 row18" data-quarto-table-cell-role="th">18</th>
<td id="T_3ce3e_row18_col0" class="data row18 col0">0</td>
<td id="T_3ce3e_row18_col1" class="data row18 col1">0</td>
<td id="T_3ce3e_row18_col2" class="data row18 col2">0</td>
<td id="T_3ce3e_row18_col3" class="data row18 col3">0</td>
<td id="T_3ce3e_row18_col4" class="data row18 col4">0</td>
<td id="T_3ce3e_row18_col5" class="data row18 col5">0</td>
<td id="T_3ce3e_row18_col6" class="data row18 col6">0</td>
<td id="T_3ce3e_row18_col7" class="data row18 col7">0</td>
<td id="T_3ce3e_row18_col8" class="data row18 col8">0</td>
<td id="T_3ce3e_row18_col9" class="data row18 col9">0</td>
<td id="T_3ce3e_row18_col10" class="data row18 col10">0</td>
<td id="T_3ce3e_row18_col11" class="data row18 col11">0</td>
<td id="T_3ce3e_row18_col12" class="data row18 col12">0</td>
<td id="T_3ce3e_row18_col13" class="data row18 col13">0</td>
<td id="T_3ce3e_row18_col14" class="data row18 col14">0</td>
<td id="T_3ce3e_row18_col15" class="data row18 col15">0</td>
<td id="T_3ce3e_row18_col16" class="data row18 col16">85</td>
<td id="T_3ce3e_row18_col17" class="data row18 col17">249</td>
<td id="T_3ce3e_row18_col18" class="data row18 col18">253</td>
<td id="T_3ce3e_row18_col19" class="data row18 col19">253</td>
<td id="T_3ce3e_row18_col20" class="data row18 col20">36</td>
<td id="T_3ce3e_row18_col21" class="data row18 col21">0</td>
<td id="T_3ce3e_row18_col22" class="data row18 col22">0</td>
<td id="T_3ce3e_row18_col23" class="data row18 col23">0</td>
<td id="T_3ce3e_row18_col24" class="data row18 col24">0</td>
<td id="T_3ce3e_row18_col25" class="data row18 col25">0</td>
<td id="T_3ce3e_row18_col26" class="data row18 col26">0</td>
<td id="T_3ce3e_row18_col27" class="data row18 col27">0</td>
</tr>
<tr class="even">
<th id="T_3ce3e_level0_row19" class="row_heading level0 row19" data-quarto-table-cell-role="th">19</th>
<td id="T_3ce3e_row19_col0" class="data row19 col0">0</td>
<td id="T_3ce3e_row19_col1" class="data row19 col1">0</td>
<td id="T_3ce3e_row19_col2" class="data row19 col2">0</td>
<td id="T_3ce3e_row19_col3" class="data row19 col3">0</td>
<td id="T_3ce3e_row19_col4" class="data row19 col4">0</td>
<td id="T_3ce3e_row19_col5" class="data row19 col5">0</td>
<td id="T_3ce3e_row19_col6" class="data row19 col6">0</td>
<td id="T_3ce3e_row19_col7" class="data row19 col7">0</td>
<td id="T_3ce3e_row19_col8" class="data row19 col8">0</td>
<td id="T_3ce3e_row19_col9" class="data row19 col9">0</td>
<td id="T_3ce3e_row19_col10" class="data row19 col10">0</td>
<td id="T_3ce3e_row19_col11" class="data row19 col11">0</td>
<td id="T_3ce3e_row19_col12" class="data row19 col12">0</td>
<td id="T_3ce3e_row19_col13" class="data row19 col13">0</td>
<td id="T_3ce3e_row19_col14" class="data row19 col14">0</td>
<td id="T_3ce3e_row19_col15" class="data row19 col15">60</td>
<td id="T_3ce3e_row19_col16" class="data row19 col16">214</td>
<td id="T_3ce3e_row19_col17" class="data row19 col17">253</td>
<td id="T_3ce3e_row19_col18" class="data row19 col18">253</td>
<td id="T_3ce3e_row19_col19" class="data row19 col19">173</td>
<td id="T_3ce3e_row19_col20" class="data row19 col20">11</td>
<td id="T_3ce3e_row19_col21" class="data row19 col21">0</td>
<td id="T_3ce3e_row19_col22" class="data row19 col22">0</td>
<td id="T_3ce3e_row19_col23" class="data row19 col23">0</td>
<td id="T_3ce3e_row19_col24" class="data row19 col24">0</td>
<td id="T_3ce3e_row19_col25" class="data row19 col25">0</td>
<td id="T_3ce3e_row19_col26" class="data row19 col26">0</td>
<td id="T_3ce3e_row19_col27" class="data row19 col27">0</td>
</tr>
<tr class="odd">
<th id="T_3ce3e_level0_row20" class="row_heading level0 row20" data-quarto-table-cell-role="th">20</th>
<td id="T_3ce3e_row20_col0" class="data row20 col0">0</td>
<td id="T_3ce3e_row20_col1" class="data row20 col1">0</td>
<td id="T_3ce3e_row20_col2" class="data row20 col2">0</td>
<td id="T_3ce3e_row20_col3" class="data row20 col3">0</td>
<td id="T_3ce3e_row20_col4" class="data row20 col4">0</td>
<td id="T_3ce3e_row20_col5" class="data row20 col5">0</td>
<td id="T_3ce3e_row20_col6" class="data row20 col6">0</td>
<td id="T_3ce3e_row20_col7" class="data row20 col7">0</td>
<td id="T_3ce3e_row20_col8" class="data row20 col8">0</td>
<td id="T_3ce3e_row20_col9" class="data row20 col9">0</td>
<td id="T_3ce3e_row20_col10" class="data row20 col10">0</td>
<td id="T_3ce3e_row20_col11" class="data row20 col11">0</td>
<td id="T_3ce3e_row20_col12" class="data row20 col12">0</td>
<td id="T_3ce3e_row20_col13" class="data row20 col13">0</td>
<td id="T_3ce3e_row20_col14" class="data row20 col14">98</td>
<td id="T_3ce3e_row20_col15" class="data row20 col15">247</td>
<td id="T_3ce3e_row20_col16" class="data row20 col16">253</td>
<td id="T_3ce3e_row20_col17" class="data row20 col17">253</td>
<td id="T_3ce3e_row20_col18" class="data row20 col18">226</td>
<td id="T_3ce3e_row20_col19" class="data row20 col19">9</td>
<td id="T_3ce3e_row20_col20" class="data row20 col20">0</td>
<td id="T_3ce3e_row20_col21" class="data row20 col21">0</td>
<td id="T_3ce3e_row20_col22" class="data row20 col22">0</td>
<td id="T_3ce3e_row20_col23" class="data row20 col23">0</td>
<td id="T_3ce3e_row20_col24" class="data row20 col24">0</td>
<td id="T_3ce3e_row20_col25" class="data row20 col25">0</td>
<td id="T_3ce3e_row20_col26" class="data row20 col26">0</td>
<td id="T_3ce3e_row20_col27" class="data row20 col27">0</td>
</tr>
<tr class="even">
<th id="T_3ce3e_level0_row21" class="row_heading level0 row21" data-quarto-table-cell-role="th">21</th>
<td id="T_3ce3e_row21_col0" class="data row21 col0">0</td>
<td id="T_3ce3e_row21_col1" class="data row21 col1">0</td>
<td id="T_3ce3e_row21_col2" class="data row21 col2">0</td>
<td id="T_3ce3e_row21_col3" class="data row21 col3">0</td>
<td id="T_3ce3e_row21_col4" class="data row21 col4">0</td>
<td id="T_3ce3e_row21_col5" class="data row21 col5">0</td>
<td id="T_3ce3e_row21_col6" class="data row21 col6">0</td>
<td id="T_3ce3e_row21_col7" class="data row21 col7">0</td>
<td id="T_3ce3e_row21_col8" class="data row21 col8">0</td>
<td id="T_3ce3e_row21_col9" class="data row21 col9">0</td>
<td id="T_3ce3e_row21_col10" class="data row21 col10">0</td>
<td id="T_3ce3e_row21_col11" class="data row21 col11">0</td>
<td id="T_3ce3e_row21_col12" class="data row21 col12">42</td>
<td id="T_3ce3e_row21_col13" class="data row21 col13">150</td>
<td id="T_3ce3e_row21_col14" class="data row21 col14">252</td>
<td id="T_3ce3e_row21_col15" class="data row21 col15">253</td>
<td id="T_3ce3e_row21_col16" class="data row21 col16">253</td>
<td id="T_3ce3e_row21_col17" class="data row21 col17">233</td>
<td id="T_3ce3e_row21_col18" class="data row21 col18">53</td>
<td id="T_3ce3e_row21_col19" class="data row21 col19">0</td>
<td id="T_3ce3e_row21_col20" class="data row21 col20">0</td>
<td id="T_3ce3e_row21_col21" class="data row21 col21">0</td>
<td id="T_3ce3e_row21_col22" class="data row21 col22">0</td>
<td id="T_3ce3e_row21_col23" class="data row21 col23">0</td>
<td id="T_3ce3e_row21_col24" class="data row21 col24">0</td>
<td id="T_3ce3e_row21_col25" class="data row21 col25">0</td>
<td id="T_3ce3e_row21_col26" class="data row21 col26">0</td>
<td id="T_3ce3e_row21_col27" class="data row21 col27">0</td>
</tr>
<tr class="odd">
<th id="T_3ce3e_level0_row22" class="row_heading level0 row22" data-quarto-table-cell-role="th">22</th>
<td id="T_3ce3e_row22_col0" class="data row22 col0">0</td>
<td id="T_3ce3e_row22_col1" class="data row22 col1">0</td>
<td id="T_3ce3e_row22_col2" class="data row22 col2">0</td>
<td id="T_3ce3e_row22_col3" class="data row22 col3">0</td>
<td id="T_3ce3e_row22_col4" class="data row22 col4">0</td>
<td id="T_3ce3e_row22_col5" class="data row22 col5">0</td>
<td id="T_3ce3e_row22_col6" class="data row22 col6">42</td>
<td id="T_3ce3e_row22_col7" class="data row22 col7">115</td>
<td id="T_3ce3e_row22_col8" class="data row22 col8">42</td>
<td id="T_3ce3e_row22_col9" class="data row22 col9">60</td>
<td id="T_3ce3e_row22_col10" class="data row22 col10">115</td>
<td id="T_3ce3e_row22_col11" class="data row22 col11">159</td>
<td id="T_3ce3e_row22_col12" class="data row22 col12">240</td>
<td id="T_3ce3e_row22_col13" class="data row22 col13">253</td>
<td id="T_3ce3e_row22_col14" class="data row22 col14">253</td>
<td id="T_3ce3e_row22_col15" class="data row22 col15">250</td>
<td id="T_3ce3e_row22_col16" class="data row22 col16">175</td>
<td id="T_3ce3e_row22_col17" class="data row22 col17">25</td>
<td id="T_3ce3e_row22_col18" class="data row22 col18">0</td>
<td id="T_3ce3e_row22_col19" class="data row22 col19">0</td>
<td id="T_3ce3e_row22_col20" class="data row22 col20">0</td>
<td id="T_3ce3e_row22_col21" class="data row22 col21">0</td>
<td id="T_3ce3e_row22_col22" class="data row22 col22">0</td>
<td id="T_3ce3e_row22_col23" class="data row22 col23">0</td>
<td id="T_3ce3e_row22_col24" class="data row22 col24">0</td>
<td id="T_3ce3e_row22_col25" class="data row22 col25">0</td>
<td id="T_3ce3e_row22_col26" class="data row22 col26">0</td>
<td id="T_3ce3e_row22_col27" class="data row22 col27">0</td>
</tr>
<tr class="even">
<th id="T_3ce3e_level0_row23" class="row_heading level0 row23" data-quarto-table-cell-role="th">23</th>
<td id="T_3ce3e_row23_col0" class="data row23 col0">0</td>
<td id="T_3ce3e_row23_col1" class="data row23 col1">0</td>
<td id="T_3ce3e_row23_col2" class="data row23 col2">0</td>
<td id="T_3ce3e_row23_col3" class="data row23 col3">0</td>
<td id="T_3ce3e_row23_col4" class="data row23 col4">0</td>
<td id="T_3ce3e_row23_col5" class="data row23 col5">0</td>
<td id="T_3ce3e_row23_col6" class="data row23 col6">187</td>
<td id="T_3ce3e_row23_col7" class="data row23 col7">253</td>
<td id="T_3ce3e_row23_col8" class="data row23 col8">253</td>
<td id="T_3ce3e_row23_col9" class="data row23 col9">253</td>
<td id="T_3ce3e_row23_col10" class="data row23 col10">253</td>
<td id="T_3ce3e_row23_col11" class="data row23 col11">253</td>
<td id="T_3ce3e_row23_col12" class="data row23 col12">253</td>
<td id="T_3ce3e_row23_col13" class="data row23 col13">253</td>
<td id="T_3ce3e_row23_col14" class="data row23 col14">197</td>
<td id="T_3ce3e_row23_col15" class="data row23 col15">86</td>
<td id="T_3ce3e_row23_col16" class="data row23 col16">0</td>
<td id="T_3ce3e_row23_col17" class="data row23 col17">0</td>
<td id="T_3ce3e_row23_col18" class="data row23 col18">0</td>
<td id="T_3ce3e_row23_col19" class="data row23 col19">0</td>
<td id="T_3ce3e_row23_col20" class="data row23 col20">0</td>
<td id="T_3ce3e_row23_col21" class="data row23 col21">0</td>
<td id="T_3ce3e_row23_col22" class="data row23 col22">0</td>
<td id="T_3ce3e_row23_col23" class="data row23 col23">0</td>
<td id="T_3ce3e_row23_col24" class="data row23 col24">0</td>
<td id="T_3ce3e_row23_col25" class="data row23 col25">0</td>
<td id="T_3ce3e_row23_col26" class="data row23 col26">0</td>
<td id="T_3ce3e_row23_col27" class="data row23 col27">0</td>
</tr>
<tr class="odd">
<th id="T_3ce3e_level0_row24" class="row_heading level0 row24" data-quarto-table-cell-role="th">24</th>
<td id="T_3ce3e_row24_col0" class="data row24 col0">0</td>
<td id="T_3ce3e_row24_col1" class="data row24 col1">0</td>
<td id="T_3ce3e_row24_col2" class="data row24 col2">0</td>
<td id="T_3ce3e_row24_col3" class="data row24 col3">0</td>
<td id="T_3ce3e_row24_col4" class="data row24 col4">0</td>
<td id="T_3ce3e_row24_col5" class="data row24 col5">0</td>
<td id="T_3ce3e_row24_col6" class="data row24 col6">103</td>
<td id="T_3ce3e_row24_col7" class="data row24 col7">253</td>
<td id="T_3ce3e_row24_col8" class="data row24 col8">253</td>
<td id="T_3ce3e_row24_col9" class="data row24 col9">253</td>
<td id="T_3ce3e_row24_col10" class="data row24 col10">253</td>
<td id="T_3ce3e_row24_col11" class="data row24 col11">253</td>
<td id="T_3ce3e_row24_col12" class="data row24 col12">232</td>
<td id="T_3ce3e_row24_col13" class="data row24 col13">67</td>
<td id="T_3ce3e_row24_col14" class="data row24 col14">1</td>
<td id="T_3ce3e_row24_col15" class="data row24 col15">0</td>
<td id="T_3ce3e_row24_col16" class="data row24 col16">0</td>
<td id="T_3ce3e_row24_col17" class="data row24 col17">0</td>
<td id="T_3ce3e_row24_col18" class="data row24 col18">0</td>
<td id="T_3ce3e_row24_col19" class="data row24 col19">0</td>
<td id="T_3ce3e_row24_col20" class="data row24 col20">0</td>
<td id="T_3ce3e_row24_col21" class="data row24 col21">0</td>
<td id="T_3ce3e_row24_col22" class="data row24 col22">0</td>
<td id="T_3ce3e_row24_col23" class="data row24 col23">0</td>
<td id="T_3ce3e_row24_col24" class="data row24 col24">0</td>
<td id="T_3ce3e_row24_col25" class="data row24 col25">0</td>
<td id="T_3ce3e_row24_col26" class="data row24 col26">0</td>
<td id="T_3ce3e_row24_col27" class="data row24 col27">0</td>
</tr>
<tr class="even">
<th id="T_3ce3e_level0_row25" class="row_heading level0 row25" data-quarto-table-cell-role="th">25</th>
<td id="T_3ce3e_row25_col0" class="data row25 col0">0</td>
<td id="T_3ce3e_row25_col1" class="data row25 col1">0</td>
<td id="T_3ce3e_row25_col2" class="data row25 col2">0</td>
<td id="T_3ce3e_row25_col3" class="data row25 col3">0</td>
<td id="T_3ce3e_row25_col4" class="data row25 col4">0</td>
<td id="T_3ce3e_row25_col5" class="data row25 col5">0</td>
<td id="T_3ce3e_row25_col6" class="data row25 col6">0</td>
<td id="T_3ce3e_row25_col7" class="data row25 col7">0</td>
<td id="T_3ce3e_row25_col8" class="data row25 col8">0</td>
<td id="T_3ce3e_row25_col9" class="data row25 col9">0</td>
<td id="T_3ce3e_row25_col10" class="data row25 col10">0</td>
<td id="T_3ce3e_row25_col11" class="data row25 col11">0</td>
<td id="T_3ce3e_row25_col12" class="data row25 col12">0</td>
<td id="T_3ce3e_row25_col13" class="data row25 col13">0</td>
<td id="T_3ce3e_row25_col14" class="data row25 col14">0</td>
<td id="T_3ce3e_row25_col15" class="data row25 col15">0</td>
<td id="T_3ce3e_row25_col16" class="data row25 col16">0</td>
<td id="T_3ce3e_row25_col17" class="data row25 col17">0</td>
<td id="T_3ce3e_row25_col18" class="data row25 col18">0</td>
<td id="T_3ce3e_row25_col19" class="data row25 col19">0</td>
<td id="T_3ce3e_row25_col20" class="data row25 col20">0</td>
<td id="T_3ce3e_row25_col21" class="data row25 col21">0</td>
<td id="T_3ce3e_row25_col22" class="data row25 col22">0</td>
<td id="T_3ce3e_row25_col23" class="data row25 col23">0</td>
<td id="T_3ce3e_row25_col24" class="data row25 col24">0</td>
<td id="T_3ce3e_row25_col25" class="data row25 col25">0</td>
<td id="T_3ce3e_row25_col26" class="data row25 col26">0</td>
<td id="T_3ce3e_row25_col27" class="data row25 col27">0</td>
</tr>
<tr class="odd">
<th id="T_3ce3e_level0_row26" class="row_heading level0 row26" data-quarto-table-cell-role="th">26</th>
<td id="T_3ce3e_row26_col0" class="data row26 col0">0</td>
<td id="T_3ce3e_row26_col1" class="data row26 col1">0</td>
<td id="T_3ce3e_row26_col2" class="data row26 col2">0</td>
<td id="T_3ce3e_row26_col3" class="data row26 col3">0</td>
<td id="T_3ce3e_row26_col4" class="data row26 col4">0</td>
<td id="T_3ce3e_row26_col5" class="data row26 col5">0</td>
<td id="T_3ce3e_row26_col6" class="data row26 col6">0</td>
<td id="T_3ce3e_row26_col7" class="data row26 col7">0</td>
<td id="T_3ce3e_row26_col8" class="data row26 col8">0</td>
<td id="T_3ce3e_row26_col9" class="data row26 col9">0</td>
<td id="T_3ce3e_row26_col10" class="data row26 col10">0</td>
<td id="T_3ce3e_row26_col11" class="data row26 col11">0</td>
<td id="T_3ce3e_row26_col12" class="data row26 col12">0</td>
<td id="T_3ce3e_row26_col13" class="data row26 col13">0</td>
<td id="T_3ce3e_row26_col14" class="data row26 col14">0</td>
<td id="T_3ce3e_row26_col15" class="data row26 col15">0</td>
<td id="T_3ce3e_row26_col16" class="data row26 col16">0</td>
<td id="T_3ce3e_row26_col17" class="data row26 col17">0</td>
<td id="T_3ce3e_row26_col18" class="data row26 col18">0</td>
<td id="T_3ce3e_row26_col19" class="data row26 col19">0</td>
<td id="T_3ce3e_row26_col20" class="data row26 col20">0</td>
<td id="T_3ce3e_row26_col21" class="data row26 col21">0</td>
<td id="T_3ce3e_row26_col22" class="data row26 col22">0</td>
<td id="T_3ce3e_row26_col23" class="data row26 col23">0</td>
<td id="T_3ce3e_row26_col24" class="data row26 col24">0</td>
<td id="T_3ce3e_row26_col25" class="data row26 col25">0</td>
<td id="T_3ce3e_row26_col26" class="data row26 col26">0</td>
<td id="T_3ce3e_row26_col27" class="data row26 col27">0</td>
</tr>
<tr class="even">
<th id="T_3ce3e_level0_row27" class="row_heading level0 row27" data-quarto-table-cell-role="th">27</th>
<td id="T_3ce3e_row27_col0" class="data row27 col0">0</td>
<td id="T_3ce3e_row27_col1" class="data row27 col1">0</td>
<td id="T_3ce3e_row27_col2" class="data row27 col2">0</td>
<td id="T_3ce3e_row27_col3" class="data row27 col3">0</td>
<td id="T_3ce3e_row27_col4" class="data row27 col4">0</td>
<td id="T_3ce3e_row27_col5" class="data row27 col5">0</td>
<td id="T_3ce3e_row27_col6" class="data row27 col6">0</td>
<td id="T_3ce3e_row27_col7" class="data row27 col7">0</td>
<td id="T_3ce3e_row27_col8" class="data row27 col8">0</td>
<td id="T_3ce3e_row27_col9" class="data row27 col9">0</td>
<td id="T_3ce3e_row27_col10" class="data row27 col10">0</td>
<td id="T_3ce3e_row27_col11" class="data row27 col11">0</td>
<td id="T_3ce3e_row27_col12" class="data row27 col12">0</td>
<td id="T_3ce3e_row27_col13" class="data row27 col13">0</td>
<td id="T_3ce3e_row27_col14" class="data row27 col14">0</td>
<td id="T_3ce3e_row27_col15" class="data row27 col15">0</td>
<td id="T_3ce3e_row27_col16" class="data row27 col16">0</td>
<td id="T_3ce3e_row27_col17" class="data row27 col17">0</td>
<td id="T_3ce3e_row27_col18" class="data row27 col18">0</td>
<td id="T_3ce3e_row27_col19" class="data row27 col19">0</td>
<td id="T_3ce3e_row27_col20" class="data row27 col20">0</td>
<td id="T_3ce3e_row27_col21" class="data row27 col21">0</td>
<td id="T_3ce3e_row27_col22" class="data row27 col22">0</td>
<td id="T_3ce3e_row27_col23" class="data row27 col23">0</td>
<td id="T_3ce3e_row27_col24" class="data row27 col24">0</td>
<td id="T_3ce3e_row27_col25" class="data row27 col25">0</td>
<td id="T_3ce3e_row27_col26" class="data row27 col26">0</td>
<td id="T_3ce3e_row27_col27" class="data row27 col27">0</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="base-line-model" class="level2">
<h2 class="anchored" data-anchor-id="base-line-model">Base-Line Model</h2>
<ul>
<li>Is always good to start with a base-line model then try to build something more comlex on top of it</li>
<li>Base-line model help us build intuition and understand the prespectives of the problem</li>
<li>Consum less time to build</li>
</ul>
<section id="pixel-similarity" class="level3">
<h3 class="anchored" data-anchor-id="pixel-similarity">Pixel Similarity</h3>
<ul>
<li>Calculate the average values for each pixel location across all images for each digit
<ul>
<li>This will generate a blurry image of the target digit</li>
</ul></li>
<li>Compare the values for each pixel location in a new image to the average</li>
</ul>
<div id="cell-23" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}}" data-outputid="7ccc20e4-7b2d-4ac7-b9ae-9dc8bac08e8e" data-execution_count="13">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># store all images of 7s and 3s as a list of tensors</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>sevens_tensors <span class="op">=</span> [tensor(Image.<span class="bu">open</span>(o)) <span class="cf">for</span> o <span class="kw">in</span> sevens]</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>threes_tensors <span class="op">=</span> [tensor(Image.<span class="bu">open</span>(o)) <span class="cf">for</span> o <span class="kw">in</span> threes]</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(sevens_tensors), <span class="bu">len</span>(threes_tensors)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<pre><code>(6265, 6131)</code></pre>
</div>
</div>
<ul>
<li>so now we have bunch of tensors, since they’re not image object anymore, we will use <code>show_image</code> of fast ai instead of <code>PILimage</code></li>
<li>Remember we can always use <code>show_image??</code> to read the documentation/ the code</li>
</ul>
<div id="cell-25" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:85}}" data-outputid="67132197-5b46-4c54-ff36-92b23f99524d" data-execution_count="14">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># show a image from the tensor list</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>show_image(threes_tensors[<span class="dv">330</span>])<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Ch4_files/figure-html/cell-15-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>Now we need to compute the value of each pixel in respect to all images (for that digit)</li>
<li>Put all images in a list of 3 dimension tensors, then stack them into a single tensor.
<ul>
<li>stack images via pytorch function <code>torch.stack</code></li>
<li>and scale pixel values from the range [0,255] to [0,1]</li>
</ul></li>
</ul>
<div id="cell-27" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}}" data-outputid="40a02a9e-12b9-42d1-811a-23c526c514a4" data-execution_count="15">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>stacked_threes<span class="op">=</span> torch.stack(threes_tensors).<span class="bu">float</span>()<span class="op">/</span><span class="dv">255</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>stacked_sevens<span class="op">=</span> torch.stack(sevens_tensors).<span class="bu">float</span>()<span class="op">/</span><span class="dv">255</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>stacked_threes.shape</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<pre><code>torch.Size([6131, 28, 28])</code></pre>
</div>
</div>
<ul>
<li><code>.shape</code> attribute tells us about the lenth of each axis
<ul>
<li>in this case we can see we have <code>6131</code> images, each of size <code>28*28</code> pixel</li>
</ul></li>
<li>Calculate the <strong>mean</strong> values for each pixel location across all images</li>
</ul>
<div id="cell-30" class="cell" data-execution_count="16">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>mean3 <span class="op">=</span> stacked_threes.mean(<span class="dv">0</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>mean7 <span class="op">=</span> stacked_sevens.mean(<span class="dv">0</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<ul>
<li>Sow our ideal 3 and 7</li>
</ul>
<div id="cell-32" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:170}}" data-outputid="5cb03cd1-bafd-43bc-98f4-0776d19d4697" data-execution_count="17">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>show_image(mean3)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>show_image(mean7)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Ch4_files/figure-html/cell-18-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Ch4_files/figure-html/cell-18-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-33" class="cell" data-execution_count="18">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co">#pick a single 3, 7 to compare it with the ideal one</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>a_3 <span class="op">=</span> stacked_threes[<span class="dv">55</span>]</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>a_7 <span class="op">=</span> stacked_sevens[<span class="dv">29</span>]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-34" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:170}}" data-outputid="2a70f861-89de-47e2-c023-071e0d5fb757" data-execution_count="19">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>show_image(a_3)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>show_image(a_7)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Ch4_files/figure-html/cell-20-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Ch4_files/figure-html/cell-20-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>so now let’s say that we want to recognize if a_3 is a 3 or 7?</li>
<li>to do that we can measure the distance between either of the two ideal 3 and 7**
<ul>
<li>because just compunting the difference canot give us the right answear always since in some cases the difference will be negative!</li>
</ul></li>
</ul>
<p><strong>to avoide that we can take 2 approaches:</strong><br>
* Take the mean of the absolute value of differences, this method called <code>L1</code> norm or <strong>mean absolute difference</strong> .<br>
* Take the mean of the square of differences (which makes everything positive) and then take the square root (which undoes the squaring), this method called <code>L2</code> norm or <strong>root mean squared error (RMSE)</strong></p>
<div id="cell-36" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}}" data-outputid="934478cc-d781-4685-e2a5-779cf50dc5c1" data-execution_count="20">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's try both</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>dis_3_abs <span class="op">=</span> (a_3<span class="op">-</span>mean3).<span class="bu">abs</span>().mean()</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>dis_3_sqr <span class="op">=</span> ((a_3<span class="op">-</span>mean3)<span class="op">**</span><span class="dv">2</span>).mean().sqrt()</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>dis_3_abs, dis_3_sqr</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="20">
<pre><code>(tensor(0.1280), tensor(0.2356))</code></pre>
</div>
</div>
<div id="cell-37" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}}" data-outputid="e3b6a438-beb5-4217-ecc4-7f64c2b67480" data-execution_count="21">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>dist_7_abs <span class="op">=</span> (a_3 <span class="op">-</span> mean7).<span class="bu">abs</span>().mean()</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>dist_7_sqr <span class="op">=</span> ((a_3 <span class="op">-</span> mean7)<span class="op">**</span><span class="dv">2</span>).mean().sqrt()</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>dist_7_abs,dist_7_sqr</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="21">
<pre><code>(tensor(0.1832), tensor(0.3356))</code></pre>
</div>
</div>
<ul>
<li><p>based on those numbers the <code>a_3</code> seems to be close to the ideal three than <code>a_7</code>to the ideal seven which seems to be right</p></li>
<li><p>In pytorch there’s a function that represent all of that for us:</p>
<ul>
<li><code>torch.nn.functional</code>, wich is recommended to be called as <code>F</code>(in fastai this recommendation is standarized!).</li>
<li><code>l1_loss</code> stand for <code>l1</code> norm, and <code>mse_loss</code> stand for <code>l2</code> norm
<ul>
<li>mse_loss still need sqrt() to fully executed</li>
</ul></li>
</ul></li>
</ul>
<div id="cell-40" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}}" data-outputid="8850f016-6539-40be-de72-8f39d1bf476b" data-execution_count="22">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>F.l1_loss(a_3.<span class="bu">float</span>(), mean7), F.mse_loss(a_3, mean7).sqrt()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="22">
<pre><code>(tensor(0.1832), tensor(0.3356))</code></pre>
</div>
</div>
</section>
<section id="computing-metrics-using-broadcasting" class="level3">
<h3 class="anchored" data-anchor-id="computing-metrics-using-broadcasting">Computing metrics using Broadcasting</h3>
<ul>
<li>If we want to test the accuracy of a model we better measure it on validation set</li>
<li>so let’s create a tensor of 3’s and 7’s of validation set directory, then calculate the accuracy of our “model” based on every tensor(image) in validation set</li>
</ul>
<div id="cell-43" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}}" data-outputid="3bbda33a-64f4-48fb-f320-39b721775285" data-execution_count="23">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co">#create tensors from image in validation set, then stack all image together</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>valid_ten_3 <span class="op">=</span> torch.stack([tensor(Image.<span class="bu">open</span>(o)) </span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>                           <span class="cf">for</span> o <span class="kw">in</span> (path<span class="op">/</span><span class="st">'valid'</span><span class="op">/</span><span class="st">'3'</span>).ls()])</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="co">#turn them into float and devide them by 255</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>valid_ten_3 <span class="op">=</span> valid_ten_3.<span class="bu">float</span>()<span class="op">/</span><span class="dv">255</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>valid_ten_7 <span class="op">=</span> torch.stack([tensor(Image.<span class="bu">open</span>(o))</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>                           <span class="cf">for</span> o <span class="kw">in</span> (path<span class="op">/</span><span class="st">'valid'</span><span class="op">/</span><span class="st">'7'</span>).ls()])</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>valid_ten_7 <span class="op">=</span> valid_ten_7.<span class="bu">float</span>()<span class="op">/</span><span class="dv">255</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>valid_ten_3.shape,valid_ten_7.shape</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="23">
<pre><code>(torch.Size([1010, 28, 28]), torch.Size([1028, 28, 28]))</code></pre>
</div>
</div>
<div id="cell-44" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}}" data-outputid="5ea720fa-3fa5-4a16-9111-3382b91be0c5" data-execution_count="24">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co">#create a function that will calculate the mean absolute error</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> min_abser(a, b): <span class="cf">return</span> (a<span class="op">-</span>b).<span class="bu">abs</span>().mean((<span class="op">-</span><span class="dv">1</span>,<span class="op">-</span><span class="dv">2</span>))</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>min_abser(valid_ten_3[<span class="dv">345</span>], mean3)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="24">
<pre><code>tensor(0.1123)</code></pre>
</div>
</div>
<ul>
<li>But this is only the absolut error with one image. Now we need to calculate this distance between the ideal 3/7 with all image in validation set in order to evaluate our model.</li>
<li>The easy method that will pop up in our mind in order to do that is to loop over all images in validation set and use the function <code>min_abser()</code> to calulate the difference over all of those images</li>
<li>The better way, is to use a method called <strong>Broadcasting</strong> which is a way of extending a tensor to match to others in order to do calulations</li>
</ul>
<div id="cell-46" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}}" data-outputid="957ea00c-2771-4872-a855-3383b877649f" data-execution_count="25">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co">#example of broadcasting:</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>tensor([<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>])<span class="op">+</span>tensor(<span class="op">-</span><span class="dv">2</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="25">
<pre><code>tensor([0, 1, 2])</code></pre>
</div>
</div>
<ul>
<li>pytorch execute a calculation between 2 tensors with different ranks(dimension), we will take adventage of that method in order to do same with our case</li>
</ul>
<div id="cell-48" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}}" data-outputid="b0354e58-f4b3-4919-88a9-20fbd77e0bb8" data-execution_count="26">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># shape of mean3/7 and the shape of validation set tensor</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>mean3.shape, valid_ten_3.shape</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="26">
<pre><code>(torch.Size([28, 28]), torch.Size([1010, 28, 28]))</code></pre>
</div>
</div>
<ul>
<li><p>There’s 1010 image and we want to compare that ideal image <code>mean3</code> against</p></li>
<li><p><code>is_3()</code> decide whether its 3 or 7 by copmuting which output of <code>min_abser()</code> is smaller</p></li>
</ul>
<div id="cell-51" class="cell" data-execution_count="27">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> is_3(x): <span class="cf">return</span> min_abser(x,mean3) <span class="op">&lt;</span> min_abser(x,mean7)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-52" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}}" data-outputid="6b0a647e-dba0-4a1b-a78e-562f519259fa" data-execution_count="28">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>is_3(a_3), is_3(a_3).<span class="bu">float</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="28">
<pre><code>(tensor(True), tensor(1.))</code></pre>
</div>
</div>
<ul>
<li>Note that when we convert the Boolean response to a float, we get 1.0 for True and 0.0 for False. Thanks to broadcasting, we can also test it on the full validation set of 3s:</li>
</ul>
<div id="cell-54" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}}" data-outputid="7328b9c8-88bb-4b04-da0e-462190524505" data-execution_count="29">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>is_3(valid_ten_3)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="29">
<pre><code>tensor([True, True, True,  ..., True, True, True])</code></pre>
</div>
</div>
<ul>
<li>Now we can calculate the accuracy for each of the 3s and 7s by taking the average of that function for all 3s and its inverse for all 7s:</li>
</ul>
<div id="cell-56" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}}" data-outputid="e2401b36-fb3a-4ad8-f9ae-2049ffed0923" data-execution_count="30">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>accuracy_3s <span class="op">=</span>      is_3(valid_ten_3).<span class="bu">float</span>() .mean()</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>accuracy_7s <span class="op">=</span> (<span class="dv">1</span> <span class="op">-</span> is_3(valid_ten_7).<span class="bu">float</span>()).mean()</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>accuracy_3s,accuracy_7s,(accuracy_3s<span class="op">+</span>accuracy_7s)<span class="op">/</span><span class="dv">2</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="30">
<pre><code>(tensor(0.9168), tensor(0.9854), tensor(0.9511))</code></pre>
</div>
</div>
<ul>
<li>We’re getting +90% accuracy just by doing base-line model!!</li>
<li>The base-Line model is good for understanding the problem and building the intuition, but we didn’t build a deep learning model yet.
<ul>
<li>we did not add the <strong>Learning</strong> fase to our model, which is a crucial part according to <strong>Arthur Samuel</strong> definition</li>
</ul></li>
<li>In other words, this model cannot be updated and improved by learning
<ul>
<li>we can’t improve pixel similarity approach by modifying set of parameters, because we don’t have one! and that’s why we need <strong>SGD</strong></li>
</ul></li>
</ul>
</section>
</section>
<section id="stochastic-gradient-descent" class="level2">
<h2 class="anchored" data-anchor-id="stochastic-gradient-descent">Stochastic Gradient Descent</h2>
<ul>
<li><p>Instead of trying to find similarity between an image and the “ideal image” we could add set of weights to each pixel, such as the heighest are associated with darker pixel and lowest are more likely to be white.</p>
<ul>
<li>for example the pixel bottom right are white in 7s, so we will give them low weights</li>
</ul></li>
<li><p>This can be represented as a function and set of weight values for each possible digit:</p>
<pre><code>def pr_eight(x,w): return (x*w).sum()</code></pre>
<ul>
<li><code>x</code> is the image we’re predicting which will be represented as vector</li>
<li><code>w</code> is the weights of the image, also vector</li>
</ul></li>
<li><p>The idea to find a method by which we update the weights, such as it can help us to make to predict better by a bit, then repeat those steps many times til we get the best prediction we can get.</p>
<ul>
<li>find the specific values for the vector w that causes the result of our function to be high for those images that are actually 8s, and low for those images that are not.</li>
</ul></li>
<li><p>Here are the steps that we are going to require, to turn this function into a machine learning classifier:</p>
<ul>
<li><ol type="1">
<li><em>Initialize</em> the weights.</li>
</ol></li>
<li><ol start="2" type="1">
<li>For each image, use these weights to <em>predict</em> whether it appears to be a 3 or a 7.</li>
</ol></li>
<li><ol start="3" type="1">
<li>Based on these predictions, calculate how good the model is (its <em>loss</em>).</li>
</ol></li>
<li><ol start="4" type="1">
<li>Calculate the <em>gradient</em>, which measures for each weight, how changing that weight would change the loss</li>
</ol></li>
<li><ol start="5" type="1">
<li><em>Step</em> (that is, change) all the weights based on that calculation.</li>
</ol></li>
<li><ol start="6" type="1">
<li>Go back to the step 2, and <em>repeat</em> the process.</li>
</ol></li>
<li><ol start="7" type="1">
<li>Iterate until you decide to <em>stop</em> the training process (for instance, because the model is good enough or you don’t want to wait any longer). <img src="1.png" class="img-fluid" alt="sgdsteps.png"></li>
</ol></li>
</ul></li>
</ul>
<section id="apllying-sgd-on-a-simple-case" class="level3">
<h3 class="anchored" data-anchor-id="apllying-sgd-on-a-simple-case">Apllying SGD on a simple case</h3>
<ul>
<li>Before applying these steps to our image classification problem, let’s illustrate what they look like in a simpler case.</li>
<li>First we will define a very simple function <code>f</code>, the quadratic—let’s pretend that this is our loss function, and x is a weight parameter of the function:</li>
</ul>
<div id="cell-63" class="cell" data-execution_count="31">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> f(x): <span class="cf">return</span> x<span class="op">**</span><span class="dv">2</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-64" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:285}}" data-outputid="352ac17f-c64c-416f-cdcf-11464606233a" data-execution_count="32">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>plot_function(f, <span class="st">'x'</span>, <span class="st">'x**2'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Ch4_files/figure-html/cell-33-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Let’s pick a rondom value for the paramter, and calculating the loss</p>
<div id="cell-66" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:285}}" data-outputid="b3c74047-ec9b-41c7-d3aa-a8f40983db09" data-execution_count="33">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>plot_function(f, <span class="st">'x'</span>, <span class="st">'x**2'</span>)</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>plt.scatter(<span class="op">-</span><span class="fl">1.5</span>, f(<span class="op">-</span><span class="fl">1.5</span>), color<span class="op">=</span><span class="st">'red'</span>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Ch4_files/figure-html/cell-34-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>now we will increase/decrease the parameter value by just a bit(0.5)and see what will happen:</li>
</ul>
<div id="cell-68" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:285}}" data-outputid="10a6c1e7-412b-4196-bb01-b7988d8787dc" data-execution_count="34">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>plot_function(f,<span class="st">'x'</span>,<span class="st">'x**2'</span>)</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>plt.scatter(<span class="op">-</span><span class="fl">1.5</span>, f(<span class="op">-</span><span class="fl">1.5</span>), color<span class="op">=</span><span class="st">'red'</span> )<span class="op">;</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>plt.scatter(<span class="op">-</span><span class="dv">1</span>,f(<span class="op">-</span><span class="dv">1</span>), color<span class="op">=</span><span class="st">'blue'</span>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Ch4_files/figure-html/cell-35-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>It seem that our loss get better(remember, the whole objective of this process is to minimize the loss to 0), we better keep increase the paramter but this time by (0.3), then(0.3):</li>
</ul>
<div id="cell-70" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:285}}" data-outputid="f0e56b28-e43b-4ec3-f637-638eff8b970f" data-execution_count="35">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>plot_function(f,<span class="st">'x'</span>,<span class="st">'x**2'</span>)</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>plt.scatter(<span class="op">-</span><span class="fl">1.5</span>, f(<span class="op">-</span><span class="fl">1.5</span>), color<span class="op">=</span><span class="st">'red'</span> )<span class="op">;</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>plt.scatter(<span class="op">-</span><span class="dv">1</span>,f(<span class="op">-</span><span class="dv">1</span>), color<span class="op">=</span><span class="st">'blue'</span>)<span class="op">;</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>plt.scatter(<span class="op">-</span><span class="fl">0.7</span>,f(<span class="op">-</span><span class="fl">0.7</span>), color<span class="op">=</span><span class="st">'green'</span>)<span class="op">;</span></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>plt.scatter(<span class="op">-</span><span class="fl">0.5</span>, f(<span class="op">-</span><span class="fl">0.5</span>), color<span class="op">=</span><span class="st">'orange'</span>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Ch4_files/figure-html/cell-36-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<ul>
<li><p>The main idea here is to adjust the paramters in a way that causes a minimal loss <img src="2.png" class="img-fluid" alt="Screenshot 2022-09-13 at 14-25-12 04_mnist_basics - Jupyter Notebook.png"></p></li>
<li><p>We can change our weight by a little in the direction of the slope, calculate our loss and adjustment again, and repeat this a few times. Eventually, we will get to the lowest point on our curve:</p></li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="3.png" class="img-fluid figure-img"></p>
<figcaption>Screenshot 2022-09-13 at 14-25-28 04_mnist_basics - Jupyter Notebook.png</figcaption>
</figure>
</div>
</section>
<section id="calculating-gradients" class="level3">
<h3 class="anchored" data-anchor-id="calculating-gradients">Calculating Gradients</h3>
<ul>
<li>It’s obvious now that in order to optimize the loss function we need to update the weights.
<ul>
<li>to do that we need the help of calculus, it will allow us to update the weights in the direction that optimize the loss</li>
</ul></li>
</ul>
</section>
<section id="calculating-derivative-on-pytorch" class="level3">
<h3 class="anchored" data-anchor-id="calculating-derivative-on-pytorch">Calculating derivative on Pytorch</h3>
<div id="cell-76" class="cell" data-execution_count="36">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co">#let's assume this variable</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> f(x): <span class="cf">return</span> x<span class="op">**</span><span class="dv">2</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>xt <span class="op">=</span> tensor(<span class="fl">3.</span>).requires_grad_()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<ul>
<li>here we create a tensor at value 3 the we call the method <code>requires_grad_</code> which will calculate the gradients in respect to that variable at that value.</li>
</ul>
<div id="cell-78" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}}" data-outputid="94abb088-874f-499b-ca05-d033be6bf9e9" data-execution_count="37">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co"># add the function f(x)=x**2 as a Y</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>yt <span class="op">=</span> f(xt)</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>yt</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="37">
<pre><code>tensor(9., grad_fn=&lt;PowBackward0&gt;)</code></pre>
</div>
</div>
<div id="cell-79" class="cell" data-execution_count="38">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># now we calculate the gradients using the backward() </span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>yt.backward()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-80" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}}" data-outputid="1f5f0573-dd2d-4037-ff67-9131b833cf7c" data-execution_count="39">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co">#now we can views the gradients by checking the `grad` attribute of the tensor:</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>xt.grad</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="39">
<pre><code>tensor(6.)</code></pre>
</div>
</div>
<div id="cell-81" class="cell" data-execution_count="40">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co">#now we will repeat the same steps but now with a vector:</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>xt <span class="op">=</span> tensor([<span class="fl">3.</span>,<span class="fl">4.</span>,<span class="fl">10.</span>]).requires_grad_()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-82" class="cell" data-execution_count="41">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> f(x): <span class="cf">return</span> (x<span class="op">**</span><span class="dv">2</span>).<span class="bu">sum</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-83" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}}" data-outputid="bd0c161f-0830-407e-966b-761d35adbafd" data-execution_count="42">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co">#let's check our function</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>f(xt)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="42">
<pre><code>tensor(125., grad_fn=&lt;SumBackward0&gt;)</code></pre>
</div>
</div>
<div id="cell-84" class="cell" data-execution_count="43">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>yt <span class="op">=</span> f(xt)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-85" class="cell" data-execution_count="44">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co">#calculate the gradients</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>yt.backward()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-86" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}}" data-outputid="1d69cad5-b02d-4db9-932e-3619fb49a6d9" data-execution_count="45">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co">#as expected 2xt</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>xt.grad</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="45">
<pre><code>tensor([ 6.,  8., 20.])</code></pre>
</div>
</div>
<div id="cell-87" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}}" data-outputid="49bdf0e3-eaad-4be2-c171-7adf78b633d5" data-execution_count="46">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co">#let's create another example</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>x<span class="op">=</span> tensor(<span class="fl">3.</span>).requires_grad_()</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>w<span class="op">=</span> tensor(<span class="fl">4.</span>).requires_grad_()</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>b<span class="op">=</span> tensor(<span class="fl">5.</span>).requires_grad_()</span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> x <span class="op">*</span> w <span class="op">+</span> b</span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>y</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="46">
<pre><code>tensor(17., grad_fn=&lt;AddBackward0&gt;)</code></pre>
</div>
</div>
<div id="cell-88" class="cell" data-execution_count="47">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>y.backward()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-89" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}}" data-outputid="8aa2c61f-02d0-4c5c-ac39-fe4781dbcd48" data-execution_count="48">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'d(y)/dx= '</span>, x.grad)</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'d(y)/dw= '</span>, w.grad)</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'d(y)/bx= '</span>, b.grad)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>d(y)/dx=  tensor(4.)
d(y)/dw=  tensor(3.)
d(y)/bx=  tensor(1.)</code></pre>
</div>
</div>
<ul>
<li>Now we have all the ingredients to apply what we have learned on a real problem.
<ul>
<li>the goal here is to apply these 7 steps we saw in order to optimize the weights which will effect the loss, which also effect the accuracy of the model</li>
</ul></li>
<li>one last thing before we do that, we will talk about Learnin rate</li>
<li>Gradient descent allow us to correct our weights by taking steps toward the optimal value of these weights, but it didn’t tell us how big or small these steps are, thats why we have to initilize a learning rate.</li>
<li>Learning rate is a value, by which our gradient calculate new weights in order to get better loss.</li>
<li>In general the learning rate is some randome value we chase between 0.1 and 0.001</li>
<li>Once we have picked a learning rate we then adjust the parameters using this simple function:</li>
</ul>
<pre><code>w-=gradient(w)*lr</code></pre>
</section>
<section id="an-end-to-end-sgd-example" class="level3">
<h3 class="anchored" data-anchor-id="an-end-to-end-sgd-example">An End-to-End SGD Example</h3>
<ul>
<li>Suppose we want to predict the speed of a <em>Roller Coaster</em> over a hump.</li>
<li>We want to build a model that predict how the speed change over time
<ul>
<li>we measure the speed of the 20 seconds manualy/ every second:</li>
</ul></li>
</ul>
<div id="cell-93" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}}" data-outputid="bd9bd54c-8b2d-4121-fb8b-7730ddbac8dc" data-execution_count="49">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>time <span class="op">=</span> torch.arange(<span class="dv">20</span>).<span class="bu">float</span>()<span class="op">;</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>time</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="49">
<pre><code>tensor([ 0.,  1.,  2.,  3.,  4.,  5.,  6.,  7.,  8.,  9., 10., 11., 12., 13., 14., 15., 16., 17., 18., 19.])</code></pre>
</div>
</div>
<ul>
<li>It might look something like this:</li>
</ul>
<div id="cell-95" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:268}}" data-outputid="8871efe9-833d-4e3b-e157-867085405911" data-execution_count="50">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co"># we add some noise to the data since this is the way we usualy find data in real world</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>speed <span class="op">=</span> torch.randn(<span class="dv">20</span>)<span class="op">*</span><span class="dv">3</span> <span class="op">+</span> <span class="fl">0.75</span><span class="op">*</span>(time<span class="op">-</span><span class="fl">9.5</span>)<span class="op">**</span><span class="dv">2</span> <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>plt.scatter(time,speed)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Ch4_files/figure-html/cell-51-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>The goal here is to find a function that matches our observastions using SGD</li>
<li>We chose here a quadratic function!.
<ul>
<li>we need to distinguish clearly between the input of the function <code>t</code> (the that’s the product of our observation) and it’s parameters <code>params</code></li>
</ul></li>
</ul>
<div id="cell-97" class="cell" data-execution_count="51">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co">#let's just assume this  quadratic function!!!</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> f(t, params):</span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>    a, b, c<span class="op">=</span> params</span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> a<span class="op">*</span>(t<span class="op">**</span><span class="dv">2</span>)<span class="op">+</span>(b<span class="op">*</span>t)<span class="op">+</span>c</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<ul>
<li>The we need to set a loss function that will tell us how good or bad our prediction of the parameters <code>a, b, c</code></li>
</ul>
<div id="cell-99" class="cell" data-execution_count="52">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> mse(preds, targets): <span class="cf">return</span>((preds <span class="op">-</span> targets)<span class="op">**</span><span class="dv">2</span>).mean().sqrt()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="step-1-initialize-the-parameters" class="level3">
<h3 class="anchored" data-anchor-id="step-1-initialize-the-parameters">Step 1: Initialize the parameters</h3>
<ul>
<li>first we need to initialize the parametrs by telling pytorch that we want to track its gradients</li>
</ul>
<div id="cell-101" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}}" data-outputid="484f4615-e1ee-4d33-c4f5-7169c50261cf" data-execution_count="53">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>params<span class="op">=</span> torch.randn(<span class="dv">3</span>).requires_grad_()</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>params</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="53">
<pre><code>tensor([-0.7658, -0.7506,  1.3525], requires_grad=True)</code></pre>
</div>
</div>
<div id="cell-102" class="cell" data-execution_count="54">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="co">#??</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>orig_params <span class="op">=</span> params.clone()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="step-2-calculate-the-predictions" class="level3">
<h3 class="anchored" data-anchor-id="step-2-calculate-the-predictions">Step 2: Calculate the predictions</h3>
<ul>
<li>Next we calculate the prediction</li>
</ul>
<div id="cell-104" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}}" data-outputid="0a08b7dd-0ddf-4b86-969f-fb482b5b0a1b" data-execution_count="55">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb84"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>preds <span class="op">=</span> f(time, params)</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>preds</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="55">
<pre><code>tensor([ 1.3525e+00, -1.6391e-01, -3.2121e+00, -7.7919e+00, -1.3903e+01, -2.1547e+01, -3.0721e+01, -4.1428e+01, -5.3666e+01, -6.7436e+01, -8.2738e+01, -9.9571e+01, -1.1794e+02, -1.3783e+02,
        -1.5926e+02, -1.8222e+02, -2.0671e+02, -2.3274e+02, -2.6029e+02, -2.8938e+02], grad_fn=&lt;AddBackward0&gt;)</code></pre>
</div>
</div>
<p>The <code>pred</code> here are the function we create earlier. * <code>f(t, params): am bm c= params return a*(t**2)+(b*t)+c</code> - where the t==<code>time</code>, and <code>params</code> are the initialized values we took in the step before, so the f will be calculated by taking those values as a part of it</p>
<div id="cell-106" class="cell" data-execution_count="56">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb86"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the actual calues and our prediction </span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> show_preds(preds, ax<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> ax <span class="kw">is</span> <span class="va">None</span>: ax<span class="op">=</span>plt.subplots()[<span class="dv">1</span>]</span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>    ax.scatter(time, speed)</span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>    ax.scatter(time, to_np(preds), color<span class="op">=</span><span class="st">'red'</span>)</span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a>    ax.set_ylim(<span class="op">-</span><span class="dv">300</span>,<span class="dv">100</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-107" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:273}}" data-outputid="2f54a4a7-7804-4f60-bca7-2d4a02dd44f1" data-execution_count="57">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb87"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>show_preds(preds)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Ch4_files/figure-html/cell-58-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>The blue dot represent the actal value</li>
<li>The red dots represent what our model
<ul>
<li>predictions are really bad, but we need to remember that these prediction are based on <strong>Random Values</strong></li>
</ul></li>
<li>So our job here is to update these values to get better predictions</li>
</ul>
</section>
<section id="step-3-calculate-the-loss" class="level3">
<h3 class="anchored" data-anchor-id="step-3-calculate-the-loss">Step 3: Calculate the loss</h3>
<ul>
<li>We calculate now the loss of our prediction</li>
<li>Remember:</li>
</ul>
<pre><code>def mse(preds, targets): return((preds - targets)**2).mean().sqrt()</code></pre>
<div id="cell-110" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}}" data-outputid="9e3c1df9-c642-415d-b534-96787665510b" data-execution_count="58">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb89"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>loss<span class="op">=</span> mse(preds, speed)</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>loss</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="58">
<pre><code>tensor(160.6979, grad_fn=&lt;SqrtBackward0&gt;)</code></pre>
</div>
</div>
<ul>
<li>Our goal is to improve this loss function by minimizing it, to be as close as possible to the target(speed)</li>
</ul>
</section>
<section id="step-4-calculate-the-gradients" class="level3">
<h3 class="anchored" data-anchor-id="step-4-calculate-the-gradients">Step 4: Calculate the gradients</h3>
<ul>
<li>In order to minimize the loss function we use the gradients to aproximate how the parameters can be changed to achieve our goal</li>
</ul>
<div id="cell-113" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}}" data-outputid="43a555c8-d7cf-4ff6-e5ea-7b661ad2088e" data-execution_count="59">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb91"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>loss.backward()</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>params.grad</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="59">
<pre><code>tensor([-165.5151,  -10.6402,   -0.7900])</code></pre>
</div>
</div>
<div id="cell-114" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}}" data-outputid="ada58905-5c60-4b9b-ecec-c5ddd197f53f" data-execution_count="60">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb93"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>params.grad</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="60">
<pre><code>tensor([-165.5151,  -10.6402,   -0.7900])</code></pre>
</div>
</div>
<div id="cell-115" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}}" data-outputid="0dee4a87-fdb2-40fc-a016-af4fde7fff7e" data-execution_count="61">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb95"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>params</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="61">
<pre><code>tensor([-0.7658, -0.7506,  1.3525], requires_grad=True)</code></pre>
</div>
</div>
</section>
<section id="step-5-step-the-weights" class="level3">
<h3 class="anchored" data-anchor-id="step-5-step-the-weights">Step 5: Step the weights</h3>
<ul>
<li><p>We need to updated the weights(paramaters) we just calculated</p>
<ul>
<li>first we need to fix the learning rate</li>
<li>then we need to call <code>.data</code> on the parameters and parameters.grad, it’s like telling pytorch to not track the change in the gradients at this point.</li>
</ul></li>
</ul>
<div id="cell-117" class="cell" data-execution_count="62">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb97"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>lr <span class="op">=</span> <span class="fl">1e-5</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>params.data <span class="op">-=</span> lr <span class="op">*</span> params.grad.data</span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>params.grad <span class="op">=</span> <span class="va">None</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<ul>
<li>Let’s see if the loss has improved:</li>
</ul>
<div id="cell-119" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}}" data-outputid="ba443a2c-6977-4415-8b7d-bdbc027b5dd0" data-execution_count="63">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb98"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>preds <span class="op">=</span> f(time,params)</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>mse(preds, speed)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="63">
<pre><code>tensor(160.4228, grad_fn=&lt;SqrtBackward0&gt;)</code></pre>
</div>
</div>
<ul>
<li>what’s about the plot</li>
</ul>
<div id="cell-121" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:273}}" data-outputid="8d5ad04d-a365-4b43-bbbc-cc35eb3ea9e2" data-execution_count="64">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb100"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>show_preds(preds)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Ch4_files/figure-html/cell-65-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>Now let’s execute all steps in one function</li>
</ul>
<div id="cell-123" class="cell" data-execution_count="65">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb101"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> apply_step(params, prn<span class="op">=</span><span class="va">True</span>):</span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>    preds <span class="op">=</span> f(time, params)</span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>    loss <span class="op">=</span> mse(preds, speed)</span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>    loss.backward()</span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a>    params.data <span class="op">-=</span> lr <span class="op">*</span> params.grad.data</span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a>    params.grad <span class="op">=</span> <span class="va">None</span></span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> prn: <span class="bu">print</span>(loss.item())</span>
<span id="cb101-8"><a href="#cb101-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> preds</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<ul>
<li>Let’s execute this steps for 100s of times</li>
</ul>
<div id="cell-125" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}}" data-outputid="d02f5675-cacd-4a7d-b0ec-a6b03f130a60" data-execution_count="66">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb102"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span> (<span class="dv">1200</span>): apply_step(params)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>160.42279052734375
160.14772033691406
159.87269592285156
159.59768676757812
159.3227081298828
159.04774475097656
158.7728271484375
158.4979248046875
158.22305297851562
157.9481964111328
157.67337036132812
157.39857482910156
157.12380981445312
156.84906005859375
156.5743408203125
156.29966735839844
156.02499389648438
155.75035095214844
155.4757537841797
155.20118713378906
154.92662048339844
154.65211486816406
154.37762451171875
154.1031494140625
153.82872009277344
153.55430603027344
153.27992248535156
153.0055694580078
152.73126220703125
152.4569549560547
152.18270874023438
151.90847778320312
151.63426208496094
151.36009216308594
151.08595275878906
150.81185913085938
150.5377655029297
150.26370239257812
149.9897003173828
149.71571350097656
149.44175720214844
149.16783142089844
148.89393615722656
148.6200714111328
148.3462371826172
148.0724334716797
147.79867553710938
147.52493286132812
147.25123596191406
146.97756958007812
146.7039337158203
146.43032836914062
146.15676879882812
145.88323974609375
145.60971069335938
145.3362579345703
145.06283569335938
144.78941345214844
144.51605224609375
144.24273681640625
143.96942138671875
143.6961669921875
143.4229278564453
143.14974975585938
142.87661743164062
142.6034698486328
142.3303985595703
142.05734252929688
141.78433227539062
141.5113525390625
141.23841857910156
140.96554565429688
140.69265747070312
140.41983032226562
140.14703369140625
139.87429809570312
139.60157775878906
139.3289031982422
139.05625915527344
138.78367614746094
138.51112365722656
138.2386016845703
137.96612548828125
137.69369506835938
137.42127990722656
137.14894104003906
136.87660217285156
136.60433959960938
136.33209228515625
136.0598907470703
135.7877197265625
135.515625
135.2435302734375
134.9715118408203
134.69952392578125
134.42759704589844
134.1556854248047
133.88381958007812
133.61199951171875
133.3402099609375
133.06849670410156
132.79681396484375
132.52517700195312
132.25357055664062
131.98204040527344
131.71051025390625
131.43905639648438
131.16763305664062
130.89627075195312
130.62493896484375
130.35366821289062
130.08242797851562
129.81126403808594
129.54013061523438
129.26902770996094
128.99798583984375
128.72698974609375
128.4560546875
128.18515014648438
127.91431427001953
127.64350891113281
127.37277221679688
127.1020736694336
126.83142852783203
126.56082916259766
126.29029083251953
126.01979064941406
125.74934387207031
125.47895812988281
125.2086410522461
124.93834686279297
124.6681137084961
124.39794921875
124.12782287597656
123.85773468017578
123.58772277832031
123.31776428222656
123.04785919189453
122.77799987792969
122.5082015991211
122.23847198486328
121.96878814697266
121.69915771484375
121.42959594726562
121.16007995605469
120.89063262939453
120.6212387084961
120.35188293457031
120.08260345458984
119.81338500976562
119.54422760009766
119.27513122558594
119.00609588623047
118.73711395263672
118.46820831298828
118.19935607910156
117.93054962158203
117.66181182861328
117.39315795898438
117.12455749511719
116.85600280761719
116.5875473022461
116.31912994384766
116.05079650878906
115.78250122070312
115.51428985595703
115.24613952636719
114.97806549072266
114.71004486083984
114.44210052490234
114.17422485351562
113.90641784667969
113.63868713378906
113.37100982666016
113.10340118408203
112.83587646484375
112.56842041015625
112.30104064941406
112.03372192382812
111.7664794921875
111.49931335449219
111.23222351074219
110.96520233154297
110.6982421875
110.43138122558594
110.16458129882812
109.89786529541016
109.63121795654297
109.36465454101562
109.09815979003906
108.83175659179688
108.56542205810547
108.2991714477539
108.03300476074219
107.76690673828125
107.50091552734375
107.23497772216797
106.96913146972656
106.70336151123047
106.43769073486328
106.17208862304688
105.90658569335938
105.64115142822266
105.37582397460938
105.1105728149414
104.84541320800781
104.58033752441406
104.31534576416016
104.05045318603516
103.78563690185547
103.52091979980469
103.25628662109375
102.99176025390625
102.72731018066406
102.46295928955078
102.1987075805664
101.9345474243164
101.67047119140625
101.40650177001953
101.14262390136719
100.87885284423828
100.61516571044922
100.35159301757812
100.0881118774414
99.8247299194336
99.56144714355469
99.29827117919922
99.03519439697266
98.772216796875
98.50934600830078
98.24658966064453
97.98394012451172
97.72138977050781
97.45895385742188
97.19661712646484
96.93439483642578
96.67227172851562
96.41026306152344
96.14837646484375
95.88658905029297
95.62493133544922
95.3633804321289
95.1019287109375
94.84060668945312
94.57940673828125
94.31830596923828
94.0573501586914
93.79650115966797
93.5357666015625
93.27516174316406
93.0146713256836
92.75431823730469
92.49407958984375
92.23397827148438
91.97398376464844
91.7141342163086
91.45439910888672
91.1948013305664
90.93533325195312
90.67599487304688
90.41679382324219
90.15772247314453
89.89878845214844
89.63999938964844
89.3813247680664
89.122802734375
88.86441802978516
88.60618591308594
88.34807586669922
88.09011840820312
87.8322982788086
87.57463073730469
87.31710815429688
87.05973052978516
86.80250549316406
86.54542541503906
86.28850555419922
86.03172302246094
85.77511596679688
85.51864624023438
85.26234436035156
85.00618743896484
84.75019836425781
84.49436950683594
84.23870086669922
83.98320007324219
83.72785949707031
83.4726791381836
83.21766662597656
82.96282958984375
82.70816802978516
82.45367431640625
82.19934844970703
81.94519805908203
81.69123077392578
81.43744659423828
81.18382263183594
80.93038940429688
80.67713928222656
80.42406463623047
80.17118072509766
79.91848754882812
79.66597747802734
79.41366577148438
79.16154479980469
78.90961456298828
78.65788269042969
78.4063491821289
78.15501403808594
77.90387725830078
77.65293884277344
77.4022216796875
77.15169525146484
76.90137481689453
76.65127563476562
76.40138244628906
76.15170288085938
75.9022445678711
75.65299224853516
75.40396881103516
75.15515899658203
74.90658569335938
74.6582260131836
74.41009521484375
74.16220092773438
73.9145278930664
73.6670913696289
73.4198989868164
73.17293548583984
72.92621612548828
72.67974853515625
72.43351745605469
72.18753051757812
71.94180297851562
71.69631958007812
71.45108795166016
71.20611572265625
70.9614028930664
70.71694946289062
70.47276306152344
70.22883605957031
69.98519134521484
69.74180603027344
69.49870300292969
69.25586700439453
69.01331329345703
68.77104187011719
68.52906036376953
68.28734588623047
68.04594421386719
67.80481719970703
67.56399536132812
67.3234634399414
67.08323669433594
66.84332275390625
66.60370635986328
66.36438751220703
66.12539672851562
65.88671875
65.64836120605469
65.41032409667969
65.17259979248047
64.93521881103516
64.69815063476562
64.46143341064453
64.22505187988281
63.98899841308594
63.7532958984375
63.5179328918457
63.282928466796875
63.04827117919922
62.81398010253906
62.580047607421875
62.34648132324219
62.11327362060547
61.88043975830078
61.64798355102539
61.41590118408203
61.184200286865234
60.95288848876953
60.72196960449219
60.49143981933594
60.26130294799805
60.031578063964844
59.80224609375
59.573326110839844
59.34482192993164
59.116729736328125
58.889068603515625
58.66182327270508
58.43500518798828
58.2086296081543
57.98268127441406
57.757179260253906
57.532127380371094
57.307525634765625
57.0833740234375
56.85968780517578
56.6364631652832
56.413700103759766
56.19141387939453
55.969608306884766
55.74828338623047
55.52744674682617
55.30709457397461
55.087249755859375
54.867897033691406
54.649051666259766
54.430721282958984
54.21290969848633
53.995609283447266
53.77884292602539
53.56260299682617
53.34690475463867
53.131744384765625
52.91713333129883
52.703067779541016
52.489566802978516
52.2766227722168
52.06424331665039
51.852447509765625
51.641231536865234
51.43058776855469
51.220542907714844
51.01108932495117
50.802242279052734
50.593997955322266
50.38636779785156
50.179351806640625
49.972965240478516
49.7672119140625
49.56209182739258
49.35761260986328
49.153778076171875
48.95060348510742
48.74808120727539
48.54623031616211
48.345054626464844
48.14455032348633
47.944732666015625
47.745609283447266
47.547176361083984
47.34945297241211
47.152435302734375
46.95613479614258
46.76055908203125
46.565704345703125
46.3715934753418
46.17822265625
45.985599517822266
45.79372787475586
45.60261535644531
45.41227340698242
45.22270965576172
45.03392028808594
44.84592056274414
44.65871810913086
44.47231674194336
44.286712646484375
44.1019287109375
43.91796875
43.734832763671875
43.552528381347656
43.37106704711914
43.190452575683594
43.01069259643555
42.83179473876953
42.65375900268555
42.476600646972656
42.30031967163086
42.12492752075195
41.9504280090332
41.77682876586914
41.6041374206543
41.43235778808594
41.26150131225586
41.09156799316406
40.92256164550781
40.75450134277344
40.5873908996582
40.42121887207031
40.256011962890625
40.091773986816406
39.92850112915039
39.766204833984375
39.60489273071289
39.4445686340332
39.285240173339844
39.12691116333008
38.96958923339844
38.81327438354492
38.65798568725586
38.50371551513672
38.35047149658203
38.19826889038086
38.04710006713867
37.896976470947266
37.74790954589844
37.59988784790039
37.45293426513672
37.30704116821289
37.1622200012207
37.01847457885742
36.87580490112305
36.73421859741211
36.593719482421875
36.454307556152344
36.31599807739258
36.17878341674805
36.04267501831055
35.90766906738281
35.77377700805664
35.640995025634766
35.509334564208984
35.378787994384766
35.24936294555664
35.121063232421875
34.993892669677734
34.86784744262695
34.74293899536133
34.619163513183594
34.49652099609375
34.37501907348633
34.2546501159668
34.13542556762695
34.01734161376953
33.90039825439453
33.78459548950195
33.66993713378906
33.55642318725586
33.44404983520508
33.332820892333984
33.22273635864258
33.113792419433594
33.00598907470703
32.89932632446289
32.79380416870117
32.68942642211914
32.58617401123047
32.484066009521484
32.38309097290039
32.28324508666992
32.18452835083008
32.086936950683594
31.99047088623047
31.89512825012207
31.800899505615234
31.70779037475586
31.61579132080078
31.5248966217041
31.435110092163086
31.346420288085938
31.25882911682129
31.17232894897461
31.086910247802734
31.002580642700195
30.919322967529297
30.83713722229004
30.756017684936523
30.675962448120117
30.596956253051758
30.51900291442871
30.442092895507812
30.36622428894043
30.291379928588867
30.217559814453125
30.14476203918457
30.07297134399414
30.00218963623047
29.93239974975586
29.863605499267578
29.79578971862793
29.72895050048828
29.6630802154541
29.598169326782227
29.534212112426758
29.4711971282959
29.409116744995117
29.347970962524414
29.287738800048828
29.228425979614258
29.170013427734375
29.11249351501465
29.055862426757812
29.000110626220703
28.945226669311523
28.891206741333008
28.83803367614746
28.78570556640625
28.734214782714844
28.683551788330078
28.63370132446289
28.584657669067383
28.53641700744629
28.488964080810547
28.442289352416992
28.396390914916992
28.35125160217285
28.306867599487305
28.263225555419922
28.220321655273438
28.178142547607422
28.136682510375977
28.095928192138672
28.055875778198242
28.016508102416992
27.977825164794922
27.9398136138916
27.902463912963867
27.865768432617188
27.829721450805664
27.794307708740234
27.759521484375
27.725353240966797
27.691795349121094
27.65884017944336
27.626476287841797
27.594696044921875
27.56348991394043
27.532852172851562
27.50277328491211
27.473243713378906
27.444255828857422
27.415802001953125
27.38787269592285
27.360462188720703
27.333559036254883
27.30715560913086
27.281248092651367
27.25582504272461
27.230878829956055
27.206403732299805
27.182390213012695
27.158830642700195
27.135719299316406
27.113048553466797
27.090810775756836
27.06899642944336
27.047603607177734
27.02661895751953
27.006038665771484
26.985857009887695
26.966068267822266
26.946659088134766
26.927631378173828
26.908971786499023
26.890676498413086
26.872737884521484
26.855154037475586
26.837913513183594
26.821012496948242
26.804445266723633
26.788204193115234
26.77228546142578
26.756681442260742
26.74138832092285
26.726398468017578
26.711708068847656
26.697311401367188
26.683198928833008
26.66937255859375
26.65582275390625
26.642541885375977
26.629533767700195
26.616785049438477
26.604291915893555
26.592052459716797
26.580062866210938
26.568313598632812
26.55680274963379
26.54552459716797
26.53447723388672
26.52365493774414
26.513051986694336
26.502666473388672
26.492490768432617
26.482528686523438
26.472766876220703
26.46320343017578
26.453842163085938
26.44466781616211
26.43568229675293
26.4268856048584
26.41826820373535
26.409826278686523
26.401559829711914
26.39346694946289
26.38553810119629
26.377775192260742
26.37017250061035
26.362730026245117
26.355438232421875
26.348299026489258
26.341310501098633
26.33446502685547
26.327762603759766
26.32120132446289
26.314775466918945
26.30848503112793
26.302322387695312
26.29629135131836
26.29038429260254
26.28460121154785
26.27894401550293
26.27340316772461
26.267974853515625
26.262662887573242
26.257463455200195
26.252370834350586
26.247386932373047
26.242507934570312
26.23773193359375
26.233055114746094
26.228477478027344
26.223997116088867
26.219608306884766
26.215314865112305
26.211111068725586
26.20699691772461
26.20296859741211
26.19902801513672
26.195167541503906
26.191389083862305
26.18769073486328
26.184070587158203
26.18052864074707
26.177061080932617
26.173667907714844
26.17034339904785
26.16709327697754
26.163909912109375
26.16079330444336
26.157745361328125
26.154760360717773
26.151840209960938
26.14898109436035
26.146183013916016
26.14344596862793
26.140766143798828
26.13814353942871
26.135576248168945
26.133060455322266
26.130603790283203
26.128196716308594
26.125839233398438
26.123537063598633
26.121280670166016
26.11907196044922
26.11690902709961
26.114797592163086
26.11272430419922
26.110698699951172
26.108718872070312
26.10677719116211
26.10487937927246
26.103023529052734
26.10120391845703
26.09942626953125
26.09768295288086
26.095979690551758
26.094310760498047
26.092681884765625
26.091081619262695
26.089519500732422
26.08799171447754
26.08649253845215
26.085031509399414
26.083599090576172
26.082195281982422
26.080820083618164
26.079477310180664
26.07816505432129
26.07687759399414
26.075618743896484
26.074386596679688
26.073179244995117
26.072004318237305
26.070846557617188
26.069719314575195
26.068614959716797
26.06753158569336
26.06647300720215
26.06543731689453
26.064424514770508
26.063432693481445
26.062463760375977
26.061511993408203
26.060583114624023
26.059673309326172
26.05878257751465
26.057912826538086
26.05706214904785
26.056228637695312
26.055410385131836
26.05461311340332
26.0538330078125
26.053068161010742
26.05232048034668
26.05158805847168
26.050870895385742
26.0501708984375
26.049484252929688
26.04881477355957
26.04815673828125
26.04751205444336
26.046886444091797
26.046268463134766
26.04566764831543
26.04507827758789
26.04450035095215
26.0439395904541
26.043384552001953
26.0428466796875
26.04231834411621
26.04180145263672
26.04129409790039
26.040800094604492
26.040315628051758
26.03984260559082
26.039377212524414
26.038921356201172
26.038476943969727
26.038042068481445
26.037616729736328
26.037200927734375
26.036794662475586
26.036394119262695
26.0360050201416
26.03562355041504
26.03525161743164
26.03488540649414
26.034526824951172
26.034177780151367
26.03383445739746
26.033498764038086
26.033170700073242
26.032852172851562
26.032535552978516
26.032228469848633
26.03192901611328
26.031635284423828
26.03134536743164
26.031064987182617
26.03078842163086
26.030517578125
26.030254364013672
26.02999496459961
26.02974510192871
26.029499053955078
26.029254913330078
26.029020309448242
26.028785705566406
26.0285587310791
26.028337478637695
26.028120040893555
26.027908325195312
26.027700424194336
26.027498245239258
26.02729606628418
26.027101516723633
26.02690887451172
26.026721954345703
26.026540756225586
26.0263614654541
26.026187896728516
26.026016235351562
26.025848388671875
26.025684356689453
26.025524139404297
26.025365829467773
26.02521324157715
26.025062561035156
26.02491569519043
26.024770736694336
26.024627685546875
26.024494171142578
26.024356842041016
26.02422523498535
26.02409553527832
26.023969650268555
26.023847579956055
26.023725509643555
26.023605346679688
26.023488998413086
26.023374557495117
26.023263931274414
26.023155212402344
26.023048400878906
26.0229434967041
26.022842407226562
26.022741317749023
26.02264404296875
26.022546768188477
26.02245330810547
26.022363662719727
26.02227210998535
26.022186279296875
26.022096633911133
26.022016525268555
26.02193260192871
26.021852493286133
26.021772384643555
26.02169418334961
26.021617889404297
26.02154541015625
26.021472930908203
26.02140235900879
26.021331787109375
26.021265029907227
26.021198272705078
26.021133422851562
26.02107048034668
26.021007537841797
26.020946502685547
26.02088737487793
26.020828247070312
26.020771026611328
26.020713806152344
26.020658493041992
26.020605087280273
26.020551681518555
26.0205020904541
26.020450592041016
26.020402908325195
26.020353317260742
26.020305633544922
26.0202579498291
26.020214080810547
26.02016830444336
26.020126342773438
26.020084381103516
26.020042419433594
26.020000457763672
26.019960403442383
26.019920349121094
26.019882202148438
26.019845962524414
26.019807815551758
26.019771575927734
26.019737243652344
26.01970100402832
26.01966667175293
26.019634246826172
26.019601821899414
26.019569396972656
26.01953887939453
26.019508361816406
26.01947784423828
26.019451141357422
26.019418716430664
26.019393920898438
26.019365310668945
26.019336700439453
26.019309997558594
26.019285202026367
26.019258499145508
26.019235610961914
26.019208908081055
26.019187927246094
26.019163131713867
26.019142150878906
26.01911735534668
26.01909637451172
26.019075393676758
26.019054412841797
26.019033432006836
26.019012451171875
26.018991470336914
26.018972396850586
26.018953323364258
26.01893424987793
26.0189151763916
26.018898010253906
26.01888084411621
26.018861770629883
26.01884651184082
26.018829345703125
26.018814086914062
26.018798828125
26.018781661987305
26.01876449584961
26.018753051757812
26.018735885620117
26.018722534179688
26.018707275390625
26.018693923950195
26.018678665161133
26.018667221069336
26.018651962280273
26.018638610839844
26.018625259399414
26.018613815307617
26.01860237121582
26.018590927124023
26.018579483032227
26.018566131591797
26.0185546875
26.018545150756836
26.01853370666504
26.018524169921875
26.018510818481445
26.01850128173828
26.018491744995117
26.018484115600586
26.018470764160156
26.018461227416992
26.018451690673828
26.018442153930664
26.018434524536133
26.018423080444336
26.018417358398438
26.018409729003906
26.018400192260742
26.018390655517578
26.018383026123047
26.018375396728516
26.018367767333984
26.018360137939453
26.018352508544922
26.01834487915039
26.01833724975586
26.018329620361328
26.018321990966797
26.018314361572266
26.018308639526367
26.01830291748047
26.01829719543457
26.018287658691406
26.01828384399414
26.01827621459961
26.01827049255371
26.018264770507812
26.018259048461914
26.018251419067383
26.018245697021484
26.018239974975586
26.018234252929688
26.01822853088379
26.01822280883789
26.018217086791992
26.01820945739746
26.018207550048828
26.018199920654297
26.01819610595703
26.0181884765625
26.018184661865234
26.0181827545166
26.018177032470703
26.018171310424805
26.01816749572754
26.01816177368164
26.018157958984375
26.01815414428711
26.01814842224121
26.018144607543945
26.018138885498047
26.01813507080078
26.018131256103516
26.01812744140625
26.018123626708984
26.01811981201172
26.018115997314453
26.018110275268555
26.018108367919922
26.018102645874023
26.01810073852539
26.018096923828125
26.018091201782227
26.01808738708496
26.018085479736328
26.018081665039062
26.018077850341797
26.018075942993164
26.018070220947266
26.01806640625
26.018062591552734
26.018062591552734
26.018056869506836
26.018054962158203
26.018049240112305
26.018049240112305
26.01804542541504
26.018041610717773
26.018037796020508
26.018035888671875
26.018033981323242
26.018030166625977
26.01802635192871
26.018022537231445
26.018020629882812
26.01801872253418
26.018014907836914
26.01801300048828
26.01801109313965
26.01800537109375
26.018003463745117
26.018001556396484
26.01799774169922
26.01799774169922
26.017993927001953
26.017990112304688
26.017988204956055
26.01798439025879
26.017982482910156
26.017980575561523
26.01797866821289
26.017974853515625
26.017972946166992
26.017969131469727
26.017967224121094
26.01796531677246
26.017963409423828
26.017959594726562
26.017959594726562
26.017955780029297
26.017953872680664
26.0179500579834
26.017948150634766
26.0179443359375
26.0179443359375
26.017942428588867
26.017940521240234
26.01793670654297
26.01793670654297
26.017932891845703
26.017929077148438
26.017929077148438
26.017927169799805
26.01792335510254
26.01792335510254
26.017919540405273
26.01791763305664
26.017913818359375
26.017911911010742
26.017911911010742
26.017908096313477
26.017906188964844
26.017902374267578
26.017902374267578
26.017898559570312
26.017898559570312
26.017894744873047
26.017892837524414
26.017892837524414
26.01789093017578
26.01788902282715
26.01788330078125
26.01788330078125
26.017881393432617
26.017879486083984
26.01787757873535
26.01787567138672
26.01787567138672
26.01786994934082
26.01786994934082
26.017868041992188
26.017868041992188
26.01786231994629
26.01786231994629
26.017860412597656
26.017860412597656
26.01785659790039
26.01785659790039
26.017852783203125
26.017850875854492
26.017847061157227
26.017847061157227
26.017845153808594
26.017845153808594
26.017841339111328
26.017837524414062
26.017837524414062
26.01783561706543
26.017833709716797
26.017831802368164
26.017831802368164
26.01782989501953
26.01782989501953
26.017826080322266
26.017822265625
26.017822265625
26.017820358276367
26.017818450927734
26.0178165435791
26.01781463623047
26.017812728881836
26.017810821533203
26.01780891418457
26.017807006835938
26.017805099487305
26.017805099487305
26.01780128479004
26.017799377441406
26.017797470092773
26.017799377441406
26.017793655395508
26.01779556274414
26.01778793334961
26.017789840698242
26.01778793334961</code></pre>
</div>
</div>
<ul>
<li>After 1200 iterations we manage to reduce the loss from <code>160.</code> to <code>26.</code></li>
<li>Now let’s plot the process</li>
</ul>
<div id="cell-127" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:221}}" data-outputid="6b0529c6-4af7-46eb-d989-173e5b51c610" data-execution_count="67">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb104"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>_,axs <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">4</span>,figsize<span class="op">=</span>(<span class="dv">12</span>,<span class="dv">3</span>))</span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ax <span class="kw">in</span> axs: show_preds(apply_step(params, <span class="va">False</span>), ax)</span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Ch4_files/figure-html/cell-68-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>After each iteration we will have a brand new quadratic function, which will be much more close to the actual one that represent the real data</li>
</ul>
</section>
<section id="step-7-stop" class="level3">
<h3 class="anchored" data-anchor-id="step-7-stop">Step 7: stop</h3>
<ul>
<li>After n# of iterations we decide to stop</li>
</ul>
</section>
<section id="summarizing-gradient-descent" class="level3">
<h3 class="anchored" data-anchor-id="summarizing-gradient-descent">Summarizing Gradient Descent</h3>
<ul>
<li>At the beginnig we start with the <strong>Weights</strong>
<ul>
<li>pick the randomly if we build the model from scartch</li>
<li>get them pretrained from another model : <strong>TransferLearning</strong></li>
</ul></li>
<li>Build a <strong>Loss Function</strong>
<ul>
<li>allow us to see how good or bad the outputs the model gives us</li>
<li>then we try to change/update the weights in way that makes the loss function better==lower</li>
</ul></li>
<li>To find a way to do that (update the weights to optimize the loss) we use <em>calculus</em> to caltulate the <strong>Gradients</strong>
<ul>
<li>gradients descent tells us either we decrease or increase the weights in order to minimize the loss (that simple!!)</li>
</ul></li>
<li>We then <strong>iterate</strong> till we reached the lowest point</li>
<li>Stop</li>
</ul>
</section>
</section>
<section id="the-mnist-loss-function" class="level2">
<h2 class="anchored" data-anchor-id="the-mnist-loss-function">The MNIST Loss Function</h2>
<ul>
<li>We saw previously the function <code>pr_eights()</code> where we represent the input images <code>x</code> as vector, just like the <code>w</code> weight vector.
<ul>
<li>here we will do the same with our <code>MNIST_sample</code></li>
</ul></li>
<li>We already have our dataset for 3s and 7s as tensors == the x of the function:
<ul>
<li>training-set: <code>stacked_threes, stacked_sevens</code></li>
<li>validation-set : <code>valid_ten_3, valid_ten_7</code></li>
</ul></li>
<li>We’ll concatenate them all into a single tensor, and also change them from a list of matrices (a rank-3 tensor) to a list of vectors (a rank-2 tensor)
<ul>
<li>by using <code>.view</code></li>
<li>which is a <code>Pytorh</code> method that changes the shape of a tensor without changing its content</li>
<li><code>-1</code> is a special parameter to <code>.view</code> that mean: <code>make this axis as big as necessary to fit the data</code></li>
</ul></li>
</ul>
<div id="cell-134" class="cell" data-execution_count="68">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb105"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>train_x <span class="op">=</span> torch.cat([stacked_threes, stacked_sevens]).view(<span class="op">-</span><span class="dv">1</span>, <span class="dv">28</span><span class="op">*</span><span class="dv">28</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-135" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}}" data-outputid="6c9d36c4-9ed8-4cf1-b840-8eb42dff988c" data-execution_count="69">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb106"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>train_x.shape</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="69">
<pre><code>torch.Size([12396, 784])</code></pre>
</div>
</div>
<ul>
<li>We need a label for each image. We’ll use <code>1</code> for 3s and <code>0</code> for 7s:</li>
</ul>
<div id="cell-137" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}}" data-outputid="8e690bb9-cc40-4622-fbac-e90a3a5461b6" data-scrolled="true" data-execution_count="70">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb108"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a>train_y <span class="op">=</span> tensor([<span class="dv">1</span>]<span class="op">*</span><span class="bu">len</span>(threes) <span class="op">+</span> [<span class="dv">0</span>]<span class="op">*</span><span class="bu">len</span>(sevens))</span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>train_x.shape,train_y.shape</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="70">
<pre><code>(torch.Size([12396, 784]), torch.Size([12396]))</code></pre>
</div>
</div>
<ul>
<li>The problem here is that <code>train_x</code> and <code>train_y</code> don’t match in terms of shape.</li>
<li>Here we will use <code>unsqueeze()</code> method to <code>train_y</code> which will return rank 2 tensor: <img src="4.png" class="img-fluid" alt="unsqueeze"></li>
</ul>
<div id="cell-139" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}}" data-outputid="ae0b21c1-4b7f-49a7-820e-fd26b15f7a84" data-execution_count="71">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb110"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>train_y<span class="op">=</span> train_y.unsqueeze(<span class="dv">1</span>)</span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>train_y.shape</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="71">
<pre><code>torch.Size([12396, 1])</code></pre>
</div>
</div>
<ul>
<li>Here we create <code>dset</code> dataset for training by ziping both dependent and independent variables.</li>
</ul>
<div id="cell-141" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}}" data-outputid="c04dcd09-2f08-4a22-c439-1b0dce3eedf3" data-execution_count="72">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb112"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>dset <span class="op">=</span> <span class="bu">list</span>(<span class="bu">zip</span>(train_x,train_y))</span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>x,y <span class="op">=</span> dset[<span class="dv">0</span>]</span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>x.shape,y</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="72">
<pre><code>(torch.Size([784]), tensor([1]))</code></pre>
</div>
</div>
<ul>
<li>Go through the same steps for validation set</li>
</ul>
<div id="cell-143" class="cell" data-execution_count="73">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb114"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>valid_x <span class="op">=</span> torch.cat([valid_ten_3, valid_ten_7]).view(<span class="op">-</span><span class="dv">1</span>, <span class="dv">28</span><span class="op">*</span><span class="dv">28</span>)</span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>valid_y <span class="op">=</span> tensor([<span class="dv">1</span>]<span class="op">*</span><span class="bu">len</span>(valid_ten_3) <span class="op">+</span> [<span class="dv">0</span>]<span class="op">*</span><span class="bu">len</span>(valid_ten_7)).unsqueeze(<span class="dv">1</span>)</span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a>valid_dset <span class="op">=</span> <span class="bu">list</span>(<span class="bu">zip</span>(valid_x,valid_y))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p><strong>Now we begin the 7 steps we saw earlier but now for the mnist model</strong><br>
### 1-INIT the parameters</p>
<div id="cell-145" class="cell" data-execution_count="74">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb115"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> init_params(size, std<span class="op">=</span><span class="fl">1.0</span>): <span class="cf">return</span> (torch.randn(size)<span class="op">*</span>std).requires_grad_()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<ul>
<li>Initialize weights</li>
</ul>
<div id="cell-147" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}}" data-outputid="f67ff7f4-72e1-476c-9ee6-9fcde24be9d1" data-execution_count="75">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb116"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>weights <span class="op">=</span> init_params((<span class="dv">28</span><span class="op">*</span><span class="dv">28</span>, <span class="dv">1</span>))</span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>weights.shape</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="75">
<pre><code>torch.Size([784, 1])</code></pre>
</div>
</div>
<ul>
<li>Initialize the bias</li>
</ul>
<div id="cell-149" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}}" data-outputid="41591b89-2ef8-48eb-f206-af951a11866f" data-execution_count="76">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb118"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a>bias <span class="op">=</span> init_params(<span class="dv">1</span>)</span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a>bias</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="76">
<pre><code>tensor([0.6863], requires_grad=True)</code></pre>
</div>
</div>
<section id="prediction-calculation" class="level3">
<h3 class="anchored" data-anchor-id="prediction-calculation">2-Prediction calculation</h3>
<ul>
<li><p>Now we can calculate the prediction based on those randome weights and biases for one <code>image[0]</code></p></li>
<li><p>In order to multiply 2 matrix you need to make sure they have same number of inner product:</p>
<ul>
<li>number of columns first matrix==number of rows second matrix</li>
</ul></li>
</ul>
<div id="cell-152" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}}" data-outputid="0f89efd4-9cc3-4dca-ac98-eb6307f0ad49" data-execution_count="77">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb120"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a>(train_x[<span class="dv">0</span>]<span class="op">*</span>weights.T).<span class="bu">sum</span>()<span class="op">+</span>bias</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="77">
<pre><code>tensor([20.2336], grad_fn=&lt;AddBackward0&gt;)</code></pre>
</div>
</div>
<ul>
<li>In python matrix multiplication is represented by <code>@</code></li>
<li>Here we create a function that return our training set as matrix multiplied <code>@</code> by weights then added to the bias radome value</li>
</ul>
<div id="cell-154" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}}" data-outputid="d0436c53-7f95-46a5-fb1b-c1234c8d16e1" data-execution_count="78">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb122"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> linear1(xb): <span class="cf">return</span> xb<span class="op">@</span>weights <span class="op">+</span> bias</span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a>preds <span class="op">=</span> linear1(train_x)</span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a>preds</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="78">
<pre><code>tensor([[20.2336],
        [17.0644],
        [15.2384],
        ...,
        [18.3804],
        [23.8567],
        [28.6816]], grad_fn=&lt;AddBackward0&gt;)</code></pre>
</div>
</div>
<ul>
<li>Check the accuracy of our modl based on random weights</li>
</ul>
<div id="cell-156" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}}" data-outputid="550e0981-7d80-49a7-f6ae-1c1e5a246d15" data-execution_count="79">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb124"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's check our accuracy</span></span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a>corrects <span class="op">=</span> (preds<span class="op">&gt;</span><span class="fl">0.0</span>).<span class="bu">float</span>()<span class="op">==</span>train_y</span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a>corrects</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="79">
<pre><code>tensor([[ True],
        [ True],
        [ True],
        ...,
        [False],
        [False],
        [False]])</code></pre>
</div>
</div>
<div id="cell-157" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}}" data-outputid="a8200bfb-1298-44f8-f54e-a12490684e51" data-execution_count="80">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb126"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check the mean</span></span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a>corrects.<span class="bu">float</span>().mean().item()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="80">
<pre><code>0.4912068545818329</code></pre>
</div>
</div>
<ul>
<li>Now let’s see what the change in accuracy is for a small change in one of the weights (note that we have to ask PyTorch not to calculate gradients as we do this, which is what <code>with torch.no_grad()</code> is doing here):</li>
</ul>
<div id="cell-159" class="cell" data-execution_count="81">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb128"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> torch.no_grad(): weights[<span class="dv">0</span>] <span class="op">*=</span> <span class="fl">1.0001</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-160" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}}" data-outputid="3d2bf4d3-bff0-4e3e-d064-db244a9428f0" data-execution_count="82">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb129"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a>preds <span class="op">=</span> linear1(train_x)</span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a>((preds<span class="op">&gt;</span><span class="fl">0.0</span>).<span class="bu">float</span>() <span class="op">==</span> train_y).<span class="bu">float</span>().mean().item()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="82">
<pre><code>0.4912068545818329</code></pre>
</div>
</div>
<ul>
<li><p>As we notice even with the change we commited in one of the weights we didn’t observe any change at all in the model accuracy! which rise a problem for our method. we need a formula that can reflexes the changes we commited to the parameters, so we update the parameters in a way that make our predictions better.</p></li>
<li><p>The problem with the thresh <code>preds&gt;0.0</code> is that the gradients are allways equal to zero, because as we know the gradients are calculate as rise over run, and in this case the small change in parameters is rarely could change the prediction from 3 to 7 or vice-versa, so the gradients will allways indicate to 0.<br>
</p></li>
<li><p>Instead we need a loss function, which when our weights results a slightly better prediction, gives us a slightly better loss function</p></li>
</ul>
<div id="cell-162" class="cell" data-execution_count="83">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb131"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a>trgts  <span class="op">=</span> tensor([<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>])</span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a>prds   <span class="op">=</span> tensor([<span class="fl">0.9</span>, <span class="fl">0.4</span>, <span class="fl">0.2</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<ul>
<li>Here we assume that the <code>trgts</code> is the image we want to predict, 1 for 3’s and 0 for 7’s,</li>
<li>So in this case the model is confident in the first image it’s a 3 with 0.9, and not sure about the second image with 0.4, and way too incorrect in the 3d image with 0.2</li>
<li>The objective is to build a loss function that will calculate the accuracy of the model and returns some metrics that will be updated if we update our parameters</li>
</ul>
<div id="cell-164" class="cell" data-execution_count="84">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb132"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> mnist_loss(predictions, targets):</span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> torch.where(targets<span class="op">==</span><span class="dv">1</span>, <span class="dv">1</span><span class="op">-</span>predictions, predictions).mean()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<ul>
<li><code>torch.where</code> is a way of puting specific condition, in other way we can say this:</li>
</ul>
<p>if targets==1: loss = 1-predictions else: targets==0</p>
<div id="cell-166" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}}" data-outputid="ebd246d0-9682-4e82-c4fd-0b5f4e694958" data-execution_count="85">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb133"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a>torch.where(trgts<span class="op">==</span><span class="dv">1</span>, <span class="dv">1</span><span class="op">-</span>prds, prds).mean()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="85">
<pre><code>tensor(0.4333)</code></pre>
</div>
</div>
<ul>
<li>See if the loss will be updated if we change the weights.
<ul>
<li>we will pass this tensor [0.9, 0.4, 0.8] and see how to change the prediction from 0.2 to 0.8 will efects the loss function</li>
</ul></li>
</ul>
<div id="cell-168" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}}" data-outputid="a817c867-df75-47cd-c06c-572f9bd1c116" data-execution_count="86">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb135"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a>mnist_loss(tensor([<span class="fl">0.9</span>, <span class="fl">0.4</span>, <span class="fl">0.8</span>]), trgts)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="86">
<pre><code>tensor(0.2333)</code></pre>
</div>
</div>
<ul>
<li>As we see here the loss function gets better when we minimize the distance between the prediction and the target in the third image<br>
</li>
<li>The problem that we still face in this method is that we assume that the predictions will allways be between 0 and 1</li>
<li>To solve this problem we need a function that return any prediction how matter bigger that 1 or smaller than 0 to the interval between those 2 numbers</li>
<li>In fact there’s a function that do the same exact thing, we call it <strong>SIGMOID FUNCTION</strong></li>
</ul>
</section>
<section id="sigmoid-function" class="level3">
<h3 class="anchored" data-anchor-id="sigmoid-function">Sigmoid Function</h3>
<p>The <code>sigmoid</code> function always outputs a number between 0 and 1. It’s defined as follows:</p>
<div id="cell-172" class="cell" data-execution_count="87">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb137"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> sigmoid(x): <span class="cf">return</span> <span class="dv">1</span><span class="op">/</span>(<span class="dv">1</span><span class="op">+</span>torch.exp(<span class="op">-</span>x))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-173" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:285}}" data-outputid="28239c24-9973-4e6e-e440-051d3349c7fe" data-execution_count="88">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb138"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a>plot_function(torch.sigmoid, title<span class="op">=</span><span class="st">'Sigmoid'</span>, <span class="bu">min</span><span class="op">=-</span><span class="dv">4</span>, <span class="bu">max</span><span class="op">=</span><span class="dv">4</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Ch4_files/figure-html/cell-89-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>Whatever input we give it to <code>Sigmoid</code> it will always return a number between 0 and 1</li>
<li>Now let’s update the <code>mnist_loss</code> by adding sigmoid to its inputs</li>
</ul>
<div id="cell-175" class="cell" data-execution_count="89">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb139"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> mnist_loss(predictions, targets):</span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a>    predictions <span class="op">=</span> predictions.sigmoid()</span>
<span id="cb139-3"><a href="#cb139-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> torch.where(targets<span class="op">==</span><span class="dv">1</span>, <span class="dv">1</span><span class="op">-</span>predictions, predictions).mean()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="sgd-and-mini-batches" class="level3">
<h3 class="anchored" data-anchor-id="sgd-and-mini-batches">SGD and Mini-Batches</h3>
<ul>
<li>Now we have our loss function for the SGD, we need to know which method we will take in order to update the gradients, we can update them after taking all the data points or after calculating each data points.</li>
<li>The first method will take a lot of time, and the second will not use much information, so we will take another track which is to use Mini-Batches and update the gradients after one mini-batch</li>
<li>How many datapoints in each batch is called batch-size. a larger batch size will produce more accurate result but it will take much time, and smaller batch-size will need many epochs to learn but it will be faster</li>
<li>We will see later how to decide the suitable batch-size for each situation</li>
<li>We will use <code>DataLoader</code> in order to shuffle data items before we create the mini-batches, so we vary the data items in each of the mini batches</li>
</ul>
<div id="cell-178" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}}" data-outputid="6b6f7bf1-36b2-4c58-fdfb-6c838bed2596" data-execution_count="90">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb140"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="co">#for example</span></span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a>c <span class="op">=</span> <span class="bu">range</span>(<span class="dv">15</span>)</span>
<span id="cb140-3"><a href="#cb140-3" aria-hidden="true" tabindex="-1"></a>dl <span class="op">=</span> DataLoader(c, batch_size<span class="op">=</span><span class="dv">5</span>, shuffle<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb140-4"><a href="#cb140-4" aria-hidden="true" tabindex="-1"></a><span class="bu">list</span>(dl)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="90">
<pre><code>[tensor([ 3, 12,  8, 10,  2]),
 tensor([ 9,  4,  7, 14,  5]),
 tensor([ 1, 13,  0,  6, 11])]</code></pre>
</div>
</div>
<ul>
<li>But in training model scenarios we won’t need any pyhton collection, we want a collection containing dependent and independent variables.
<ul>
<li>A tuple that contains dependents and independent variables called in <code>Pytorch</code> a <code>Dataset</code></li>
</ul></li>
<li>Here is a simple <code>dataset</code>:</li>
</ul>
<div id="cell-180" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}}" data-outputid="6a77f3da-fe8e-42d9-86b0-696ef1ef73f3" data-execution_count="91">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb142"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a>ds <span class="op">=</span> L(<span class="bu">enumerate</span>(string.ascii_lowercase))</span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a>ds</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="91">
<pre><code>(#26) [(0, 'a'),(1, 'b'),(2, 'c'),(3, 'd'),(4, 'e'),(5, 'f'),(6, 'g'),(7, 'h'),(8, 'i'),(9, 'j')...]</code></pre>
</div>
</div>
<ul>
<li>When we pass a <code>Dataset</code> to a <code>DataLoader</code> we will get back mini-batches which are themselves tuples of tensors representing batches of independent and dependent variables:</li>
</ul>
<div id="cell-182" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}}" data-outputid="1d6464e1-22fa-462e-b1ac-2eca015d6850" data-execution_count="92">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb144"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a>dl <span class="op">=</span> DataLoader(ds, batch_size<span class="op">=</span><span class="dv">6</span>, shuffle<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb144-2"><a href="#cb144-2" aria-hidden="true" tabindex="-1"></a><span class="bu">list</span>(dl)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="92">
<pre><code>[(tensor([17, 18, 10, 22,  8, 14]), ('r', 's', 'k', 'w', 'i', 'o')),
 (tensor([20, 15,  9, 13, 21, 12]), ('u', 'p', 'j', 'n', 'v', 'm')),
 (tensor([ 7, 25,  6,  5, 11, 23]), ('h', 'z', 'g', 'f', 'l', 'x')),
 (tensor([ 1,  3,  0, 24, 19, 16]), ('b', 'd', 'a', 'y', 't', 'q')),
 (tensor([2, 4]), ('c', 'e'))]</code></pre>
</div>
</div>
</section>
<section id="putting-it-all-together" class="level3">
<h3 class="anchored" data-anchor-id="putting-it-all-together">Putting It All Together</h3>
<p><strong>Now we have :</strong><br>
* dset, valid_dset * linear1 * mnist_loss * sigmoid_function</p>
<p><strong>we can create the model from scratch</strong></p>
<p><strong>First we re-intialize our parameters:</strong></p>
<div id="cell-185" class="cell" data-execution_count="93">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb146"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a>weights <span class="op">=</span> init_params((<span class="dv">28</span><span class="op">*</span><span class="dv">28</span>,<span class="dv">1</span>))</span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a>bias <span class="op">=</span> init_params(<span class="dv">1</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<ul>
<li>Then create the <code>DataLoader</code> from <code>Dataset</code></li>
</ul>
<div id="cell-187" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}}" data-outputid="1259a996-f2af-4525-e50a-d0132510c1e6" data-execution_count="94">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb147"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a>dl <span class="op">=</span> DataLoader(dset, batch_size<span class="op">=</span><span class="dv">256</span>)</span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a>xb,yb <span class="op">=</span> first(dl)</span>
<span id="cb147-3"><a href="#cb147-3" aria-hidden="true" tabindex="-1"></a>xb.shape,yb.shape</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="94">
<pre><code>(torch.Size([256, 784]), torch.Size([256, 1]))</code></pre>
</div>
</div>
<ul>
<li>We’ll do the same for the validation set:</li>
</ul>
<div id="cell-189" class="cell" data-execution_count="95">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb149"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a>valid_dl <span class="op">=</span> DataLoader(valid_dset, batch_size<span class="op">=</span><span class="dv">256</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<ul>
<li>Let’s create a mini-batch of size 4 for testing:</li>
</ul>
<div id="cell-191" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}}" data-outputid="f8112328-e27f-463a-ca79-f2bcf0017bfb" data-execution_count="96">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb150"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a>batch <span class="op">=</span> train_x[:<span class="dv">4</span>]</span>
<span id="cb150-2"><a href="#cb150-2" aria-hidden="true" tabindex="-1"></a>batch.shape</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="96">
<pre><code>torch.Size([4, 784])</code></pre>
</div>
</div>
<ul>
<li>Call <code>linear1</code> model we created earlier on the <code>batch</code>:</li>
</ul>
<div id="cell-193" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}}" data-outputid="d87621d9-6466-44d1-a63d-4702a162eec7" data-execution_count="97">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb152"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a>preds <span class="op">=</span> linear1(batch)</span>
<span id="cb152-2"><a href="#cb152-2" aria-hidden="true" tabindex="-1"></a>preds</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="97">
<pre><code>tensor([[-2.1876],
        [-8.3973],
        [ 2.5000],
        [-4.9473]], grad_fn=&lt;AddBackward0&gt;)</code></pre>
</div>
</div>
<ul>
<li>Create the loss function:</li>
</ul>
<div id="cell-195" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}}" data-outputid="7a386378-9998-4f2b-cb5c-e0a4c172e48f" data-execution_count="98">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb154"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a>loss <span class="op">=</span> mnist_loss(preds, train_y[:<span class="dv">4</span>])</span>
<span id="cb154-2"><a href="#cb154-2" aria-hidden="true" tabindex="-1"></a>loss</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="98">
<pre><code>tensor(0.7419, grad_fn=&lt;MeanBackward0&gt;)</code></pre>
</div>
</div>
<ul>
<li>Now we can calculate the gradients:</li>
</ul>
<div id="cell-197" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}}" data-outputid="fa9bf47b-9c39-4935-e941-76248b7828ee" data-execution_count="99">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb156"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a>loss.backward()</span>
<span id="cb156-2"><a href="#cb156-2" aria-hidden="true" tabindex="-1"></a>weights.grad.shape,weights.grad.mean(),bias.grad</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="99">
<pre><code>(torch.Size([784, 1]), tensor(-0.0061), tensor([-0.0420]))</code></pre>
</div>
</div>
<ul>
<li>Let’s put that all these steps in a single function:</li>
</ul>
<div id="cell-199" class="cell" data-execution_count="100">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb158"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calc_grad(xb, yb, model):</span>
<span id="cb158-2"><a href="#cb158-2" aria-hidden="true" tabindex="-1"></a>    preds <span class="op">=</span> model(xb)</span>
<span id="cb158-3"><a href="#cb158-3" aria-hidden="true" tabindex="-1"></a>    loss <span class="op">=</span> mnist_loss(preds, yb)</span>
<span id="cb158-4"><a href="#cb158-4" aria-hidden="true" tabindex="-1"></a>    loss.backward()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<ul>
<li>And test it..</li>
</ul>
<div id="cell-201" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}}" data-outputid="a9fb716b-415b-4b20-df9c-8b8c064832fa" data-execution_count="101">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb159"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a>calc_grad(batch, train_y[:<span class="dv">4</span>], linear1)</span>
<span id="cb159-2"><a href="#cb159-2" aria-hidden="true" tabindex="-1"></a>weights.grad.mean(), bias.grad</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="101">
<pre><code>(tensor(-0.0121), tensor([-0.0840]))</code></pre>
</div>
</div>
<ul>
<li>But look what happens if we call it twice:</li>
</ul>
<div id="cell-203" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}}" data-outputid="4bcd01f3-d790-4243-a4eb-5277d0e1aebb" data-execution_count="102">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb161"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a>calc_grad(batch, train_y[:<span class="dv">4</span>], linear1)</span>
<span id="cb161-2"><a href="#cb161-2" aria-hidden="true" tabindex="-1"></a>weights.grad.mean(),bias.grad</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="102">
<pre><code>(tensor(-0.0182), tensor([-0.1260]))</code></pre>
</div>
</div>
<ul>
<li>The gradients have changed!
<ul>
<li>in order to not calculate the gradients and add to the last one every time we call this function <code>calc_grad</code>we need to use <code>grad.zero_</code> which set the current gradients to zero</li>
</ul></li>
</ul>
<div id="cell-205" class="cell" data-execution_count="103">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb163"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a>weights.grad.zero_()</span>
<span id="cb163-2"><a href="#cb163-2" aria-hidden="true" tabindex="-1"></a>bias.grad.zero_()<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<ul>
<li>Our only remaining step is to update the weights and biases based on the gradient and learning rate. When we do so, we have to tell PyTorch not to take the gradient of this step too—otherwise things will get very confusing when we try to compute the derivative at the next batch! If we assign to the data attribute of a tensor then PyTorch will not take the gradient of that step. Here’s our basic training loop for an epoch:</li>
</ul>
<div id="cell-207" class="cell" data-execution_count="104">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb164"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> train_epoch(model, lr, params):</span>
<span id="cb164-2"><a href="#cb164-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> xb,yb <span class="kw">in</span> dl:</span>
<span id="cb164-3"><a href="#cb164-3" aria-hidden="true" tabindex="-1"></a>        calc_grad(xb, yb, model)</span>
<span id="cb164-4"><a href="#cb164-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> p <span class="kw">in</span> params:</span>
<span id="cb164-5"><a href="#cb164-5" aria-hidden="true" tabindex="-1"></a>            p.data <span class="op">-=</span> p.grad<span class="op">*</span>lr</span>
<span id="cb164-6"><a href="#cb164-6" aria-hidden="true" tabindex="-1"></a>            p.grad.zero_()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<ul>
<li>Let’s build a function that calculate the batch accuracy</li>
</ul>
<div id="cell-209" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}}" data-outputid="04757e50-e50a-4ddf-e2a8-a8928582d5f5" data-execution_count="105">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb165"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a><span class="co"># accuracy of the batch</span></span>
<span id="cb165-2"><a href="#cb165-2" aria-hidden="true" tabindex="-1"></a>(preds<span class="op">&gt;</span><span class="fl">0.0</span>).<span class="bu">float</span>() <span class="op">==</span> train_y[:<span class="dv">4</span>]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="105">
<pre><code>tensor([[False],
        [False],
        [ True],
        [False]])</code></pre>
</div>
</div>
<ul>
<li>Function to calculate our validation accuracy:</li>
</ul>
<div id="cell-211" class="cell" data-execution_count="106">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb167"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> batch_accuracy(xb, yb):</span>
<span id="cb167-2"><a href="#cb167-2" aria-hidden="true" tabindex="-1"></a>    preds <span class="op">=</span> xb.sigmoid()</span>
<span id="cb167-3"><a href="#cb167-3" aria-hidden="true" tabindex="-1"></a>    correct <span class="op">=</span> (preds<span class="op">&gt;</span><span class="fl">0.5</span>) <span class="op">==</span> yb</span>
<span id="cb167-4"><a href="#cb167-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> correct.<span class="bu">float</span>().mean()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-212" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}}" data-outputid="ffca677c-237d-4c4e-dd4e-7c59b6b5f46b" data-execution_count="107">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb168"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check if it works</span></span>
<span id="cb168-2"><a href="#cb168-2" aria-hidden="true" tabindex="-1"></a>batch_accuracy(linear1(batch), train_y[:<span class="dv">4</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="107">
<pre><code>tensor(0.2500)</code></pre>
</div>
</div>
<div id="cell-213" class="cell" data-execution_count="108">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb170"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a><span class="co"># all together</span></span>
<span id="cb170-2"><a href="#cb170-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> validate_epoch(model):</span>
<span id="cb170-3"><a href="#cb170-3" aria-hidden="true" tabindex="-1"></a>    accs <span class="op">=</span> [batch_accuracy(model(xb), yb) <span class="cf">for</span> xb,yb <span class="kw">in</span> valid_dl]</span>
<span id="cb170-4"><a href="#cb170-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">round</span>(torch.stack(accs).mean().item(), <span class="dv">4</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-214" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}}" data-outputid="f988ddfc-145a-4808-c24b-a9e2cc7cbb60" data-execution_count="109">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb171"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a>validate_epoch(linear1)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="109">
<pre><code>0.5262</code></pre>
</div>
</div>
<ul>
<li>Now lets train for one epoch and see if the accuracy improve</li>
</ul>
<div id="cell-216" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}}" data-outputid="940c3dec-de3a-4cdd-c4d7-477bcf8f9787" data-execution_count="110">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb173"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a>lr <span class="op">=</span> <span class="fl">1.</span></span>
<span id="cb173-2"><a href="#cb173-2" aria-hidden="true" tabindex="-1"></a>params <span class="op">=</span> weights,bias</span>
<span id="cb173-3"><a href="#cb173-3" aria-hidden="true" tabindex="-1"></a>train_epoch(linear1, lr, params)</span>
<span id="cb173-4"><a href="#cb173-4" aria-hidden="true" tabindex="-1"></a>validate_epoch(linear1)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="110">
<pre><code>0.6663</code></pre>
</div>
</div>
<ul>
<li>Thats promising
<ul>
<li>from <code>0.4642</code> to <code>0.6096</code> after one epoch</li>
</ul></li>
<li>Then do a few more:</li>
</ul>
<div id="cell-218" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}}" data-outputid="5ee1f2ef-cdce-41a8-c23e-50fbf45224d9" data-execution_count="111">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb175"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb175-1"><a href="#cb175-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">20</span>):</span>
<span id="cb175-2"><a href="#cb175-2" aria-hidden="true" tabindex="-1"></a>    train_epoch(linear1, lr, params)</span>
<span id="cb175-3"><a href="#cb175-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(validate_epoch(linear1), end<span class="op">=</span><span class="st">' '</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>0.8265 0.89 0.9183 0.9276 0.9398 0.9467 0.9506 0.9525 0.9559 0.9579 0.9599 0.9608 0.9613 0.9618 0.9633 0.9638 0.9647 0.9657 0.9672 0.9677 </code></pre>
</div>
</div>
</section>
<section id="creating-an-optimizer" class="level3">
<h3 class="anchored" data-anchor-id="creating-an-optimizer">Creating an Optimizer</h3>
<ul>
<li>As we know the model we created is only for learning .
<ul>
<li>in real world scenarios we do not need to implement everything from scratch, framworks like <code>Pytorch</code> and <code>Fastai</code> provide us with everything.</li>
</ul></li>
<li>The <code>linear1</code> model we created can be remplaced with <code>nn.Linear</code> which can do the same work and more
<ul>
<li><code>nn.Linear</code> combine the role of <code>linear1</code> and <code>weights+bias</code></li>
</ul></li>
</ul>
<div id="cell-221" class="cell" data-execution_count="112">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb177"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb177-1"><a href="#cb177-1" aria-hidden="true" tabindex="-1"></a>linear_model <span class="op">=</span> nn.Linear(<span class="dv">28</span><span class="op">*</span><span class="dv">28</span>, <span class="dv">1</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<ul>
<li>Every PyTorch module knows what parameters it has that can be trained; they are available through the <code>parameters</code> method:</li>
</ul>
<div id="cell-223" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}}" data-outputid="f893354b-4edf-413e-cd56-cc9769bc593c" data-execution_count="113">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb178"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb178-1"><a href="#cb178-1" aria-hidden="true" tabindex="-1"></a>w, b <span class="op">=</span> linear_model.parameters()</span>
<span id="cb178-2"><a href="#cb178-2" aria-hidden="true" tabindex="-1"></a>w.shape, b.shape</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="113">
<pre><code>(torch.Size([1, 784]), torch.Size([1]))</code></pre>
</div>
</div>
<ul>
<li>We can create optimizer class</li>
</ul>
<div id="cell-225" class="cell" data-execution_count="114">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb180"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb180-1"><a href="#cb180-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> BasicOptim:</span>
<span id="cb180-2"><a href="#cb180-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>,params,lr): <span class="va">self</span>.params,<span class="va">self</span>.lr <span class="op">=</span> <span class="bu">list</span>(params),lr</span>
<span id="cb180-3"><a href="#cb180-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb180-4"><a href="#cb180-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> step(<span class="va">self</span>, <span class="op">*</span>args, <span class="op">**</span>kwargs):</span>
<span id="cb180-5"><a href="#cb180-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> p <span class="kw">in</span> <span class="va">self</span>.params: p.data <span class="op">-=</span> p.grad.data <span class="op">*</span> <span class="va">self</span>.lr</span>
<span id="cb180-6"><a href="#cb180-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb180-7"><a href="#cb180-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> zero_grad(<span class="va">self</span>, <span class="op">*</span>args, <span class="op">**</span>kwargs):</span>
<span id="cb180-8"><a href="#cb180-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> p <span class="kw">in</span> <span class="va">self</span>.params: p.grad <span class="op">=</span> <span class="va">None</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-226" class="cell" data-execution_count="115">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb181"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb181-1"><a href="#cb181-1" aria-hidden="true" tabindex="-1"></a><span class="co"># passing the model params to the optimizer</span></span>
<span id="cb181-2"><a href="#cb181-2" aria-hidden="true" tabindex="-1"></a>opt <span class="op">=</span> BasicOptim(linear_model.parameters(), lr)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-227" class="cell" data-execution_count="116">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb182"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb182-1"><a href="#cb182-1" aria-hidden="true" tabindex="-1"></a><span class="co"># simplifying the epoch training function</span></span>
<span id="cb182-2"><a href="#cb182-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> train_epoch(model):</span>
<span id="cb182-3"><a href="#cb182-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> xb,yb <span class="kw">in</span> dl:</span>
<span id="cb182-4"><a href="#cb182-4" aria-hidden="true" tabindex="-1"></a>        calc_grad(xb, yb, model)</span>
<span id="cb182-5"><a href="#cb182-5" aria-hidden="true" tabindex="-1"></a>        opt.step()</span>
<span id="cb182-6"><a href="#cb182-6" aria-hidden="true" tabindex="-1"></a>        opt.zero_grad()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-228" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}}" data-outputid="a1e82818-61ed-43bd-e10f-960f02c9ae20" data-execution_count="117">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb183"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb183-1"><a href="#cb183-1" aria-hidden="true" tabindex="-1"></a><span class="co"># validation doesn't change</span></span>
<span id="cb183-2"><a href="#cb183-2" aria-hidden="true" tabindex="-1"></a>validate_epoch(linear_model)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="117">
<pre><code>0.4606</code></pre>
</div>
</div>
<div id="cell-229" class="cell" data-execution_count="118">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb185"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true" tabindex="-1"></a><span class="co"># simplifying the training loop:</span></span>
<span id="cb185-2"><a href="#cb185-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> train_model(model, epochs):</span>
<span id="cb185-3"><a href="#cb185-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(epochs):</span>
<span id="cb185-4"><a href="#cb185-4" aria-hidden="true" tabindex="-1"></a>        train_epoch(model)</span>
<span id="cb185-5"><a href="#cb185-5" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(validate_epoch(model), end<span class="op">=</span><span class="st">' '</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-230" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}}" data-outputid="cf026a2f-4a0a-4cdf-e29c-e347f014421a" data-execution_count="119">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb186"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb186-1"><a href="#cb186-1" aria-hidden="true" tabindex="-1"></a><span class="co"># same results as before</span></span>
<span id="cb186-2"><a href="#cb186-2" aria-hidden="true" tabindex="-1"></a>train_model(linear_model, <span class="dv">20</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>0.4932 0.7686 0.8555 0.9136 0.9346 0.9482 0.957 0.9634 0.9658 0.9678 0.9697 0.9717 0.9736 0.9746 0.9761 0.9771 0.9775 0.9775 0.978 0.9785 </code></pre>
</div>
</div>
<ul>
<li>The good thing is all of this is provided by <code>Fastai</code>:</li>
</ul>
<div id="cell-232" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}}" data-outputid="2afa89d2-18b8-4c88-f49f-e7334bf40a41" data-execution_count="120">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb188"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb188-1"><a href="#cb188-1" aria-hidden="true" tabindex="-1"></a>linear_model <span class="op">=</span> nn.Linear(<span class="dv">28</span><span class="op">*</span><span class="dv">28</span>,<span class="dv">1</span>)</span>
<span id="cb188-2"><a href="#cb188-2" aria-hidden="true" tabindex="-1"></a>opt <span class="op">=</span> SGD(linear_model.parameters(), lr)</span>
<span id="cb188-3"><a href="#cb188-3" aria-hidden="true" tabindex="-1"></a>train_model(linear_model, <span class="dv">20</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>0.4932 0.8179 0.8496 0.9141 0.9346 0.9482 0.957 0.9619 0.9658 0.9673 0.9692 0.9712 0.9741 0.9751 0.9761 0.9775 0.9775 0.978 0.9785 0.979 </code></pre>
</div>
</div>
<ul>
<li>Fastai also provides <code>Learner.fit</code>, which we can use instead of <code>train_model</code>. To create a <code>Learner</code> we first need to create a <code>DataLoaders</code>, by passing in our training and validation <code>DataLoader</code>s:</li>
</ul>
<div id="cell-234" class="cell" data-execution_count="121">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb190"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb190-1"><a href="#cb190-1" aria-hidden="true" tabindex="-1"></a>dls <span class="op">=</span> DataLoaders(dl, valid_dl)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<ul>
<li>To create a <code>Learner</code> we need to pass in all the elements that we’ve created in this chapter: the <code>DataLoaders</code>, the model, the optimization function (which will be passed the parameters), the loss function, and optionally any metrics to print:</li>
</ul>
<div id="cell-236" class="cell" data-execution_count="122">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb191"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a>learn <span class="op">=</span> Learner(dls, nn.Linear(<span class="dv">28</span><span class="op">*</span><span class="dv">28</span>,<span class="dv">1</span>), opt_func<span class="op">=</span>SGD,</span>
<span id="cb191-2"><a href="#cb191-2" aria-hidden="true" tabindex="-1"></a>                loss_func<span class="op">=</span>mnist_loss, metrics<span class="op">=</span>batch_accuracy)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Now we can call <code>fit</code>:</p>
<div id="cell-238" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:363}}" data-outputid="7e2697a3-3d78-48fb-ab1d-004ce359e422" data-execution_count="123">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb192"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb192-1"><a href="#cb192-1" aria-hidden="true" tabindex="-1"></a>learn.fit(<span class="dv">10</span>, lr<span class="op">=</span>lr)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">
<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">epoch</th>
<th data-quarto-table-cell-role="th">train_loss</th>
<th data-quarto-table-cell-role="th">valid_loss</th>
<th data-quarto-table-cell-role="th">batch_accuracy</th>
<th data-quarto-table-cell-role="th">time</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>0.636709</td>
<td>0.503144</td>
<td>0.495584</td>
<td>00:00</td>
</tr>
<tr class="even">
<td>1</td>
<td>0.429828</td>
<td>0.248517</td>
<td>0.777233</td>
<td>00:00</td>
</tr>
<tr class="odd">
<td>2</td>
<td>0.161680</td>
<td>0.155361</td>
<td>0.861629</td>
<td>00:00</td>
</tr>
<tr class="even">
<td>3</td>
<td>0.072948</td>
<td>0.097721</td>
<td>0.917566</td>
<td>00:00</td>
</tr>
<tr class="odd">
<td>4</td>
<td>0.040128</td>
<td>0.073205</td>
<td>0.936212</td>
<td>00:00</td>
</tr>
<tr class="even">
<td>5</td>
<td>0.027210</td>
<td>0.059466</td>
<td>0.950442</td>
<td>00:00</td>
</tr>
<tr class="odd">
<td>6</td>
<td>0.021837</td>
<td>0.050799</td>
<td>0.957802</td>
<td>00:00</td>
</tr>
<tr class="even">
<td>7</td>
<td>0.019398</td>
<td>0.044980</td>
<td>0.964181</td>
<td>00:00</td>
</tr>
<tr class="odd">
<td>8</td>
<td>0.018122</td>
<td>0.040853</td>
<td>0.966143</td>
<td>00:00</td>
</tr>
<tr class="even">
<td>9</td>
<td>0.017330</td>
<td>0.037788</td>
<td>0.968106</td>
<td>00:00</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="adding-a-nonlinearity" class="level3">
<h3 class="anchored" data-anchor-id="adding-a-nonlinearity">Adding a Nonlinearity</h3>
<ul>
<li>So far we managed to create a linear function that can predict hand written digit with high performance.</li>
<li>But still, it’s just a simple linear classifier, with very constraint abilities.</li>
<li>To make it more complex and capable handle complex tasks, we need to add something non-linear between two linear classifiers.
<ul>
<li><strong>This is gives us a Neural network</strong></li>
</ul></li>
<li>Here a basic architecture of a neural network:</li>
</ul>
<div id="cell-241" class="cell" data-execution_count="124">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb193"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb193-1"><a href="#cb193-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> simple_net(xb): </span>
<span id="cb193-2"><a href="#cb193-2" aria-hidden="true" tabindex="-1"></a>    res <span class="op">=</span> xb<span class="op">@</span>w1 <span class="op">+</span> b1 <span class="co"># first linear function</span></span>
<span id="cb193-3"><a href="#cb193-3" aria-hidden="true" tabindex="-1"></a>    res <span class="op">=</span> res.<span class="bu">max</span>(tensor(<span class="fl">0.0</span>)) <span class="co"># non linear function</span></span>
<span id="cb193-4"><a href="#cb193-4" aria-hidden="true" tabindex="-1"></a>    res <span class="op">=</span> res<span class="op">@</span>w2 <span class="op">+</span> b2  <span class="co"># 2nd linear function</span></span>
<span id="cb193-5"><a href="#cb193-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> res</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-242" class="cell" data-execution_count="125">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb194"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb194-1"><a href="#cb194-1" aria-hidden="true" tabindex="-1"></a>w1 <span class="op">=</span> init_params((<span class="dv">28</span><span class="op">*</span><span class="dv">28</span>,<span class="dv">30</span>))</span>
<span id="cb194-2"><a href="#cb194-2" aria-hidden="true" tabindex="-1"></a>b1 <span class="op">=</span> init_params(<span class="dv">30</span>)</span>
<span id="cb194-3"><a href="#cb194-3" aria-hidden="true" tabindex="-1"></a>w2 <span class="op">=</span> init_params((<span class="dv">30</span>,<span class="dv">1</span>))</span>
<span id="cb194-4"><a href="#cb194-4" aria-hidden="true" tabindex="-1"></a>b2 <span class="op">=</span> init_params(<span class="dv">1</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-243" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}}" data-outputid="3a2ccdf2-273c-4953-9eb4-b13af5a7867a" data-execution_count="126">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb195"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb195-1"><a href="#cb195-1" aria-hidden="true" tabindex="-1"></a>w1.shape, b1.shape</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="126">
<pre><code>(torch.Size([784, 30]), torch.Size([30]))</code></pre>
</div>
</div>
<ul>
<li>the lines: <code>res = xb@w1 + b1</code> and <code>res@w2 + b2</code> are two classifier, basic linear function similar to the <code>nn.Linear</code> we use previously</li>
<li>While the line <code>res = res.max(tensor(0.0))</code> is a non linear function
<ul>
<li>this function called <em>rectified linear unit</em> <strong>ReLu</strong> which return every negative number with <code>0</code></li>
</ul></li>
<li>So if we think about this architecture we have here:
<ul>
<li>first we have a linear function that does the matrix multiplication between dataset tensors and initialzed weights + bias and output 30 (we can chose any number) features, which represent for each a different mix of pixels</li>
<li>these outputs are taken by the <code>ReLU</code> and converted to <code>0</code> if they are negativem and <code>x==y</code> if it not, then output also 30 features to the next linear layer, which will do the sam computaion as the first and output the results</li>
</ul></li>
<li>In pythorch there’s a modul that fit our neural nets here: <code>nn.Sequential()</code>.
<ul>
<li>take results from a layer to another</li>
</ul></li>
<li>we also replace the linear function we built by <code>nn.Linear</code> and <code>max((0.0))</code> with <code>nn.ReLU()</code></li>
</ul>
<div id="cell-246" class="cell" data-execution_count="127">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb197"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb197-1"><a href="#cb197-1" aria-hidden="true" tabindex="-1"></a>simple_net <span class="op">=</span> nn.Sequential(</span>
<span id="cb197-2"><a href="#cb197-2" aria-hidden="true" tabindex="-1"></a>    nn.Linear(<span class="dv">28</span><span class="op">*</span><span class="dv">28</span>,<span class="dv">30</span>),</span>
<span id="cb197-3"><a href="#cb197-3" aria-hidden="true" tabindex="-1"></a>    nn.ReLU(),</span>
<span id="cb197-4"><a href="#cb197-4" aria-hidden="true" tabindex="-1"></a>    nn.Linear(<span class="dv">30</span>,<span class="dv">1</span>)</span>
<span id="cb197-5"><a href="#cb197-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-247" class="cell" data-execution_count="128">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb198"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb198-1"><a href="#cb198-1" aria-hidden="true" tabindex="-1"></a><span class="co">#lets try the model again but now with 2 layers</span></span>
<span id="cb198-2"><a href="#cb198-2" aria-hidden="true" tabindex="-1"></a>learn <span class="op">=</span> Learner(dls, simple_net, opt_func<span class="op">=</span>SGD,</span>
<span id="cb198-3"><a href="#cb198-3" aria-hidden="true" tabindex="-1"></a>                loss_func<span class="op">=</span>mnist_loss, metrics<span class="op">=</span>batch_accuracy)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-248" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:1000}}" data-outputid="97cf12cb-b3ab-4862-9419-137a91e2dacc" data-execution_count="129">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb199"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb199-1"><a href="#cb199-1" aria-hidden="true" tabindex="-1"></a>learn.fit(<span class="dv">40</span>, <span class="fl">0.1</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">
<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">epoch</th>
<th data-quarto-table-cell-role="th">train_loss</th>
<th data-quarto-table-cell-role="th">valid_loss</th>
<th data-quarto-table-cell-role="th">batch_accuracy</th>
<th data-quarto-table-cell-role="th">time</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>0.333021</td>
<td>0.396112</td>
<td>0.512267</td>
<td>00:00</td>
</tr>
<tr class="even">
<td>1</td>
<td>0.152461</td>
<td>0.235238</td>
<td>0.797350</td>
<td>00:00</td>
</tr>
<tr class="odd">
<td>2</td>
<td>0.083573</td>
<td>0.117471</td>
<td>0.911678</td>
<td>00:00</td>
</tr>
<tr class="even">
<td>3</td>
<td>0.054309</td>
<td>0.078720</td>
<td>0.940628</td>
<td>00:00</td>
</tr>
<tr class="odd">
<td>4</td>
<td>0.040829</td>
<td>0.061228</td>
<td>0.956330</td>
<td>00:00</td>
</tr>
<tr class="even">
<td>5</td>
<td>0.034006</td>
<td>0.051490</td>
<td>0.963690</td>
<td>00:00</td>
</tr>
<tr class="odd">
<td>6</td>
<td>0.030123</td>
<td>0.045381</td>
<td>0.966634</td>
<td>00:00</td>
</tr>
<tr class="even">
<td>7</td>
<td>0.027619</td>
<td>0.041218</td>
<td>0.968106</td>
<td>00:00</td>
</tr>
<tr class="odd">
<td>8</td>
<td>0.025825</td>
<td>0.038200</td>
<td>0.969087</td>
<td>00:00</td>
</tr>
<tr class="even">
<td>9</td>
<td>0.024441</td>
<td>0.035901</td>
<td>0.969578</td>
<td>00:00</td>
</tr>
<tr class="odd">
<td>10</td>
<td>0.023321</td>
<td>0.034082</td>
<td>0.971541</td>
<td>00:00</td>
</tr>
<tr class="even">
<td>11</td>
<td>0.022387</td>
<td>0.032598</td>
<td>0.972031</td>
<td>00:00</td>
</tr>
<tr class="odd">
<td>12</td>
<td>0.021592</td>
<td>0.031353</td>
<td>0.974485</td>
<td>00:00</td>
</tr>
<tr class="even">
<td>13</td>
<td>0.020904</td>
<td>0.030284</td>
<td>0.975466</td>
<td>00:00</td>
</tr>
<tr class="odd">
<td>14</td>
<td>0.020300</td>
<td>0.029352</td>
<td>0.975466</td>
<td>00:00</td>
</tr>
<tr class="even">
<td>15</td>
<td>0.019766</td>
<td>0.028526</td>
<td>0.975466</td>
<td>00:00</td>
</tr>
<tr class="odd">
<td>16</td>
<td>0.019288</td>
<td>0.027788</td>
<td>0.976448</td>
<td>00:00</td>
</tr>
<tr class="even">
<td>17</td>
<td>0.018857</td>
<td>0.027124</td>
<td>0.977429</td>
<td>00:00</td>
</tr>
<tr class="odd">
<td>18</td>
<td>0.018465</td>
<td>0.026523</td>
<td>0.978410</td>
<td>00:00</td>
</tr>
<tr class="even">
<td>19</td>
<td>0.018107</td>
<td>0.025977</td>
<td>0.978901</td>
<td>00:00</td>
</tr>
<tr class="odd">
<td>20</td>
<td>0.017777</td>
<td>0.025479</td>
<td>0.978901</td>
<td>00:00</td>
</tr>
<tr class="even">
<td>21</td>
<td>0.017473</td>
<td>0.025022</td>
<td>0.979392</td>
<td>00:00</td>
</tr>
<tr class="odd">
<td>22</td>
<td>0.017191</td>
<td>0.024601</td>
<td>0.980373</td>
<td>00:00</td>
</tr>
<tr class="even">
<td>23</td>
<td>0.016927</td>
<td>0.024213</td>
<td>0.980373</td>
<td>00:00</td>
</tr>
<tr class="odd">
<td>24</td>
<td>0.016680</td>
<td>0.023855</td>
<td>0.981354</td>
<td>00:00</td>
</tr>
<tr class="even">
<td>25</td>
<td>0.016449</td>
<td>0.023521</td>
<td>0.981354</td>
<td>00:00</td>
</tr>
<tr class="odd">
<td>26</td>
<td>0.016230</td>
<td>0.023211</td>
<td>0.981354</td>
<td>00:00</td>
</tr>
<tr class="even">
<td>27</td>
<td>0.016023</td>
<td>0.022922</td>
<td>0.981354</td>
<td>00:00</td>
</tr>
<tr class="odd">
<td>28</td>
<td>0.015827</td>
<td>0.022653</td>
<td>0.981845</td>
<td>00:00</td>
</tr>
<tr class="even">
<td>29</td>
<td>0.015641</td>
<td>0.022401</td>
<td>0.981845</td>
<td>00:00</td>
</tr>
<tr class="odd">
<td>30</td>
<td>0.015463</td>
<td>0.022165</td>
<td>0.981845</td>
<td>00:00</td>
</tr>
<tr class="even">
<td>31</td>
<td>0.015294</td>
<td>0.021944</td>
<td>0.983317</td>
<td>00:00</td>
</tr>
<tr class="odd">
<td>32</td>
<td>0.015132</td>
<td>0.021736</td>
<td>0.982826</td>
<td>00:00</td>
</tr>
<tr class="even">
<td>33</td>
<td>0.014977</td>
<td>0.021541</td>
<td>0.982826</td>
<td>00:00</td>
</tr>
<tr class="odd">
<td>34</td>
<td>0.014828</td>
<td>0.021357</td>
<td>0.982336</td>
<td>00:00</td>
</tr>
<tr class="even">
<td>35</td>
<td>0.014686</td>
<td>0.021184</td>
<td>0.982336</td>
<td>00:00</td>
</tr>
<tr class="odd">
<td>36</td>
<td>0.014549</td>
<td>0.021019</td>
<td>0.982336</td>
<td>00:00</td>
</tr>
<tr class="even">
<td>37</td>
<td>0.014417</td>
<td>0.020864</td>
<td>0.982336</td>
<td>00:00</td>
</tr>
<tr class="odd">
<td>38</td>
<td>0.014290</td>
<td>0.020716</td>
<td>0.982336</td>
<td>00:00</td>
</tr>
<tr class="even">
<td>39</td>
<td>0.014168</td>
<td>0.020576</td>
<td>0.982336</td>
<td>00:00</td>
</tr>
</tbody>
</table>
</div>
</div>
<ul>
<li>At this point we did everything we can to improve the model performane, and we got an accuracy of <code>982826</code>, which is very solid number.</li>
<li>from here on, all we can do is looking inside our model and understand the mechanic of it in each steps</li>
</ul>
<div id="cell-250" class="cell" data-execution_count="130">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb200"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb200-1"><a href="#cb200-1" aria-hidden="true" tabindex="-1"></a><span class="co"># we can see the architecture of the model</span></span>
<span id="cb200-2"><a href="#cb200-2" aria-hidden="true" tabindex="-1"></a>m <span class="op">=</span>learn.model</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<ul>
<li>As expected the model architecture contains 2 layers and a non-linear function in-between.</li>
</ul>
<div id="cell-252" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}}" data-outputid="f1ac4c80-b0e1-4c0b-c4f6-70c257cfd28e" data-execution_count="131">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb201"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb201-1"><a href="#cb201-1" aria-hidden="true" tabindex="-1"></a>m</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="131">
<pre><code>Sequential(
  (0): Linear(in_features=784, out_features=30, bias=True)
  (1): ReLU()
  (2): Linear(in_features=30, out_features=1, bias=True)
)</code></pre>
</div>
</div>
<ul>
<li>We could also see what did the model learn in each layer</li>
</ul>
<div id="cell-254" class="cell" data-execution_count="133">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb203"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb203-1"><a href="#cb203-1" aria-hidden="true" tabindex="-1"></a>w, b<span class="op">=</span> m[<span class="dv">0</span>].parameters()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-255" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:102}}" data-outputid="1f7116c4-6d7a-4bdc-8d84-abe7339cae33" data-execution_count="137">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb204"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb204-1"><a href="#cb204-1" aria-hidden="true" tabindex="-1"></a>show_image(w[<span class="dv">22</span>].view(<span class="dv">28</span>,<span class="dv">28</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Ch4_files/figure-html/cell-134-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/iSmailTG\.github\.io\/Lifelong-Learner\.github\.io\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>